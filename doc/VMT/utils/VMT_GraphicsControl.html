<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of VMT_GraphicsControl</title>
  <meta name="keywords" content="VMT_GraphicsControl">
  <meta name="description" content="--- THE VELOCITY MAPPING TOOLBOX ---">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html VMT --><!-- menu.html utils -->
<h1>VMT_GraphicsControl
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>--- THE VELOCITY MAPPING TOOLBOX ---</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = VMT_GraphicsControl(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> --- THE VELOCITY MAPPING TOOLBOX ---
 VMT_GRAPHICSCONTROL is a sub-GUI of VMT which allows the user to
 dynamically adjust the figures.
__________________________________________________________________________
 Frank L. Engel, U.S. Geological Survey, Illinois Water Science Center
 (fengel@usgs.gov)

 Code contributed by P.R. Jackson, D. Parsons, D. Mueller, and J. Czuba.
__________________________________________________________________________</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="cptcmap.html" class="code" title="function varargout = cptcmap(varargin)">cptcmap</a>	CPTCMAP Apply a .cpt file as colormap to an axis</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function VMT_GraphicsControl_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = VMT_GraphicsControl_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function UseDataLimitsPlanview_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function MinVelocityPlanview_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function MaxVelocityPlanview_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function ColormapPlanview_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function UseDataLimitsMCS_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function MinVelocityMCS_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function MaxVelocityMCS_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function ColormapMCS_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function ReferenceVelocity_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function UseDefaults_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function Distance_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function Depth_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function ApplyChanges_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function Close_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function initGUI(handles)</a></li><li><a href="#_sub18" class="code">function [guiparams] = createGUIparams</a></li><li><a href="#_sub19" class="code">function set_enable(handles,enable_state)</a></li><li><a href="#_sub20" class="code">function UpdatePlotStyle(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function load_prefs(hfigure)</a></li><li><a href="#_sub22" class="code">function store_prefs(hfigure,pref)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = VMT_GraphicsControl(varargin)</a>
0002 <span class="comment">% --- THE VELOCITY MAPPING TOOLBOX ---</span>
0003 <span class="comment">% VMT_GRAPHICSCONTROL is a sub-GUI of VMT which allows the user to</span>
0004 <span class="comment">% dynamically adjust the figures.</span>
0005 <span class="comment">%__________________________________________________________________________</span>
0006 <span class="comment">% Frank L. Engel, U.S. Geological Survey, Illinois Water Science Center</span>
0007 <span class="comment">% (fengel@usgs.gov)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Code contributed by P.R. Jackson, D. Parsons, D. Mueller, and J. Czuba.</span>
0010 <span class="comment">%__________________________________________________________________________</span>
0011 
0012 <span class="comment">% Last Modified by GUIDE v2.5 24-Jul-2013 14:55:36</span>
0013 
0014 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0015 gui_Singleton = 1;
0016 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0017     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0018     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction VMT_GraphicsControl_OpeningFcn(hObject, eventdata, handles, varargin)">VMT_GraphicsControl_OpeningFcn</a>, <span class="keyword">...</span>
0019     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = VMT_GraphicsControl_OutputFcn(hObject, eventdata, handles)">VMT_GraphicsControl_OutputFcn</a>, <span class="keyword">...</span>
0020     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0021     <span class="string">'gui_Callback'</span>,   []);
0022 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0023     gui_State.gui_Callback = str2func(varargin{1});
0024 <span class="keyword">end</span>
0025 
0026 <span class="keyword">if</span> nargout
0027     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0028 <span class="keyword">else</span>
0029     gui_mainfcn(gui_State, varargin{:});
0030 <span class="keyword">end</span>
0031 <span class="comment">% End initialization code - DO NOT EDIT</span>
0032 
0033 
0034 <span class="comment">% --- Executes just before VMT_GraphicsControl is made visible.</span>
0035 <a name="_sub1" href="#_subfunctions" class="code">function VMT_GraphicsControl_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0036 <span class="comment">% This function has no output args, see OutputFcn.</span>
0037 <span class="comment">% hObject    handle to figure</span>
0038 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0039 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0040 <span class="comment">% varargin   command line arguments to VMT_GraphicsControl (see VARARGIN)</span>
0041 
0042 <span class="comment">% Choose default command line output for VMT_GraphicsControl</span>
0043 handles.output = hObject;
0044 
0045 <span class="comment">% Update handles structure</span>
0046 guidata(hObject, handles);
0047 
0048 <span class="comment">% Initialize the GUI parameters:</span>
0049 <span class="comment">% ------------------------------</span>
0050 guiparams = <a href="#_sub18" class="code" title="subfunction [guiparams] = createGUIparams">createGUIparams</a>;
0051 
0052 <span class="comment">% Store the application data</span>
0053 <span class="comment">% --------------------------</span>
0054 setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0055 
0056 <span class="comment">% Load the GUI preferences:</span>
0057 <span class="comment">% -------------------------</span>
0058 <a href="#_sub21" class="code" title="subfunction load_prefs(hfigure)">load_prefs</a>(handles.figure1)
0059 
0060 <span class="comment">% Initialize the GUI:</span>
0061 <span class="comment">% -------------------</span>
0062 <a href="#_sub17" class="code" title="subfunction initGUI(handles)">initGUI</a>(handles)
0063 <span class="comment">% set_enable(handles,'init')</span>
0064 
0065 <span class="comment">% UIWAIT makes VMT_GraphicsControl wait for user response (see UIRESUME)</span>
0066 <span class="comment">% uiwait(handles.figure1);</span>
0067 
0068 <span class="comment">% [EOF] VMT_GraphicsControl_OpeningFcn</span>
0069 
0070 
0071 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0072 <a name="_sub2" href="#_subfunctions" class="code">function varargout = VMT_GraphicsControl_OutputFcn(hObject, eventdata, handles)</a>
0073 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0074 <span class="comment">% hObject    handle to figure</span>
0075 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0076 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0077 
0078 <span class="comment">% Get default command line output from handles structure</span>
0079 varargout{1} = handles.output;
0080 
0081 
0082 <span class="comment">% --- Executes on button press in UseDataLimitsPlanview.</span>
0083 <a name="_sub3" href="#_subfunctions" class="code">function UseDataLimitsPlanview_Callback(hObject, eventdata, handles)</a>
0084 
0085 <span class="comment">% Get the Application Data</span>
0086 <span class="comment">% ------------------------</span>
0087 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0088 
0089 <span class="comment">% Modify the Application data:</span>
0090 <span class="comment">% ----------------------------</span>
0091 guiparams.use_data_limits_planview = logical(get(hObject,<span class="string">'Value'</span>)); <span class="comment">% boolean</span>
0092 
0093 <span class="keyword">if</span> ~guiparams.use_data_limits_planview <span class="comment">% User wants to set limits</span>
0094     <span class="comment">% Update the GUI:</span>
0095     <span class="comment">% ---------------</span>
0096     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setplanviewon'</span>)
0097 <span class="keyword">else</span>
0098     <span class="comment">% Re-populate edit boxes with the data limits</span>
0099     <span class="comment">% -------------------------------------------</span>
0100     <span class="comment">% Compute the data limits to populate edit boxes</span>
0101     PVdata = guiparams.gp_vmt.iric_anv_planview_data.outmat';
0102     PVdata(:,4:5) = PVdata(:,4:5).*100; <span class="comment">% in cm/s</span>
0103     vr = sqrt(PVdata(:,4).^2+PVdata(:,5).^2);
0104     guiparams.min_velocity_planview  = nanmin(vr);
0105     guiparams.max_velocity_planview  = nanmax(vr);
0106     
0107     <span class="comment">% Ensure correct units</span>
0108     <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
0109         <span class="comment">% No further action</span>
0110     <span class="keyword">else</span>
0111         guiparams.min_velocity_planview = guiparams.min_velocity_planview*0.03281;
0112         guiparams.max_velocity_planview = guiparams.max_velocity_planview*0.03281;
0113         <span class="comment">%guiparams.min_velocity_mcs      = guiparams.min_velocity_mcs*0.03281;</span>
0114         <span class="comment">%guiparams.max_velocity_mcs      = guiparams.max_velocity_mcs*0.03281;</span>
0115     <span class="keyword">end</span>
0116     set(handles.MinVelocityPlanview, <span class="string">'String'</span>, guiparams.min_velocity_planview);
0117     set(handles.MaxVelocityPlanview, <span class="string">'String'</span>, guiparams.max_velocity_planview);
0118     
0119     <span class="comment">% Update the GUI:</span>
0120     <span class="comment">% ---------------</span>
0121     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setplanviewoff'</span>)
0122 <span class="keyword">end</span>
0123 
0124 <span class="comment">% Re-store the Application data:</span>
0125 <span class="comment">% ------------------------------</span>
0126 setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0127 
0128 <span class="comment">% [EOF] VMT_GraphicsControl_OutputFcn</span>
0129 
0130 
0131 
0132 
0133 
0134 <a name="_sub4" href="#_subfunctions" class="code">function MinVelocityPlanview_Callback(hObject, eventdata, handles)</a>
0135 <span class="comment">% Get the Application data:</span>
0136 <span class="comment">% -------------------------</span>
0137 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0138 
0139 <span class="comment">% Get the new entry and make sure it is valid (numeric, positive):</span>
0140 <span class="comment">% ----------------------------------------------------------------</span>
0141 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0142 is_a_number = ~isnan(new_value);
0143 
0144 <span class="comment">% Modify the Application data:</span>
0145 <span class="comment">% ----------------------------</span>
0146 <span class="keyword">if</span> is_a_number
0147     guiparams.min_velocity_planview = new_value;
0148     
0149     <span class="comment">% Re-store the Application data:</span>
0150     <span class="comment">% ------------------------------</span>
0151     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0152     
0153 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0154     set(hObject,<span class="string">'String'</span>,guiparams.min_velocity_planview)
0155 <span class="keyword">end</span>
0156 <span class="comment">% [EOF] MinVelocityPlanview_Callback</span>
0157 
0158 
0159 
0160 
0161 
0162 <a name="_sub5" href="#_subfunctions" class="code">function MaxVelocityPlanview_Callback(hObject, eventdata, handles)</a>
0163 <span class="comment">% Get the Application data:</span>
0164 <span class="comment">% -------------------------</span>
0165 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0166 
0167 <span class="comment">% Get the new entry and make sure it is valid (numeric, positive):</span>
0168 <span class="comment">% ----------------------------------------------------------------</span>
0169 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0170 is_a_number = ~isnan(new_value);
0171 
0172 <span class="comment">% Modify the Application data:</span>
0173 <span class="comment">% ----------------------------</span>
0174 <span class="keyword">if</span> is_a_number
0175     guiparams.max_velocity_planview = new_value;
0176     
0177     <span class="comment">% Re-store the Application data:</span>
0178     <span class="comment">% ------------------------------</span>
0179     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0180     
0181 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0182     set(hObject,<span class="string">'String'</span>,guiparams.max_velocity_planview)
0183 <span class="keyword">end</span>
0184 <span class="comment">% [EOF] MaxVelocityPlanview_Callback</span>
0185 
0186 
0187 
0188 <span class="comment">% --- Executes on selection change in ColormapPlanview.</span>
0189 <a name="_sub6" href="#_subfunctions" class="code">function ColormapPlanview_Callback(hObject, eventdata, handles)</a>
0190 <span class="comment">% Get the Application data:</span>
0191 <span class="comment">% -------------------------</span>
0192 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0193 guiprefs  = getappdata(handles.figure1,<span class="string">'guiprefs'</span>);
0194 
0195 <span class="comment">% Modify the Application data:</span>
0196 <span class="comment">% ----------------------------</span>
0197 idx_variable = get(hObject,<span class="string">'Value'</span>);
0198 guiparams.idx_colormap_planview = idx_variable;
0199 guiparams.colormap_planview = guiparams.colormaps_planview(idx_variable).string;
0200 
0201 <span class="keyword">if</span> strcmpi(<span class="string">'Browse for more (cpt)...'</span>,guiparams.colormap_planview)
0202     [FileName,PathName] = uigetfile(<span class="string">'*.cpt'</span>,<span class="string">'Select the cpt colormap file'</span>,<span class="keyword">...</span>
0203         fullfile(guiprefs.cpt_path,guiprefs.cpt_file));
0204     guiparams.cpt_planview = fullfile(PathName,FileName);
0205     
0206     <span class="comment">% Update the preferences:</span>
0207     <span class="comment">% -----------------------</span>
0208     guiprefs.cpt_path = PathName;
0209     guiprefs.cpt_file = FileName;
0210     setappdata(handles.figure1,<span class="string">'guiprefs'</span>,guiprefs)
0211     <a href="#_sub22" class="code" title="subfunction store_prefs(hfigure,pref)">store_prefs</a>(handles.figure1,<span class="string">'cptplanview'</span>)
0212 <span class="keyword">end</span>
0213 
0214 <span class="comment">% Re-store the Application data:</span>
0215 <span class="comment">% ------------------------------</span>
0216 setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0217 
0218 <span class="comment">% [EOF] ColormapPlanview_Callback</span>
0219 
0220 
0221 
0222 <span class="comment">% --- Executes on button press in UseDataLimitsMCS.</span>
0223 <a name="_sub7" href="#_subfunctions" class="code">function UseDataLimitsMCS_Callback(hObject, eventdata, handles)</a>
0224 <span class="comment">% Get the Application Data</span>
0225 <span class="comment">% ------------------------</span>
0226 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0227 
0228 <span class="comment">% Modify the Application data:</span>
0229 <span class="comment">% ----------------------------</span>
0230 guiparams.use_data_limits_mcs = logical(get(hObject,<span class="string">'Value'</span>)); <span class="comment">% boolean</span>
0231 
0232 <span class="keyword">if</span> ~guiparams.use_data_limits_mcs <span class="comment">% User wants to set limits</span>
0233     <span class="comment">% Update the GUI:</span>
0234     <span class="comment">% ---------------</span>
0235     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setmcson'</span>)
0236 <span class="keyword">else</span>
0237     <span class="comment">% Re-populate edit boxes with the data limits</span>
0238     <span class="comment">% -------------------------------------------</span>
0239     <span class="comment">% Compute the data limits to populate edit boxes</span>
0240     <span class="keyword">switch</span> guiparams.gp_vmt.contour
0241         <span class="keyword">case</span> <span class="string">'streamwise'</span>
0242             vmin = nanmin(guiparams.gp_vmt.V.uSmooth(:));
0243             vmax = nanmax(guiparams.gp_vmt.V.uSmooth(:));
0244         <span class="keyword">case</span> <span class="string">'transverse'</span>
0245             vmin = nanmin(guiparams.gp_vmt.V.vSmooth(:));
0246             vmax = nanmax(guiparams.gp_vmt.V.vSmooth(:));
0247         <span class="keyword">case</span> <span class="string">'vertical'</span>
0248             vmin = nanmin(guiparams.gp_vmt.V.wSmooth(:));
0249             vmax = nanmax(guiparams.gp_vmt.V.wSmooth(:));
0250         <span class="keyword">case</span> <span class="string">'mag'</span>
0251             vmin = nanmin(guiparams.gp_vmt.V.mcsMagSmooth(:));
0252             vmax = nanmax(guiparams.gp_vmt.V.mcsMagSmooth(:));
0253         <span class="keyword">case</span> <span class="string">'east'</span>
0254             vmin = nanmin(guiparams.gp_vmt.V.mcsMagSmooth(:));
0255             vmax = nanmax(guiparams.gp_vmt.V.mcsMagSmooth(:));
0256         <span class="keyword">case</span> <span class="string">'north'</span>
0257             vmin = nanmin(guiparams.gp_vmt.V.mcsEastSmooth(:));
0258             vmax = nanmax(guiparams.gp_vmt.V.mcsNorthSmooth(:));
0259         <span class="keyword">case</span> <span class="string">'primary_zsd'</span>
0260             vmin = nanmin(guiparams.gp_vmt.V.vpSmooth(:));
0261             vmax = nanmax(guiparams.gp_vmt.V.vpSmooth(:));
0262         <span class="keyword">case</span> <span class="string">'secondary_zsd'</span>
0263             vmin = nanmin(guiparams.gp_vmt.V.vsSmooth(:));
0264             vmax = nanmax(guiparams.gp_vmt.V.vsSmooth(:));
0265         <span class="keyword">case</span> <span class="string">'primary_roz'</span>
0266             vmin = nanmin(guiparams.gp_vmt.V.Roz.upSmooth(:));
0267             vmax = nanmax(guiparams.gp_vmt.V.Roz.upSmooth(:));
0268         <span class="keyword">case</span> <span class="string">'secondary_roz'</span>
0269             vmin = nanmin(guiparams.gp_vmt.V.Roz.usSmooth(:));
0270             vmax = nanmax(guiparams.gp_vmt.V.Roz.usSmooth(:));
0271         <span class="keyword">case</span> <span class="string">'primary_roz_x'</span>
0272             vmin = nanmin(guiparams.gp_vmt.V.Roz.upxSmooth(:));
0273             vmax = nanmax(guiparams.gp_vmt.V.Roz.upxSmooth(:));
0274         <span class="keyword">case</span> <span class="string">'primary_roz_y'</span>
0275             vmin = nanmin(guiparams.gp_vmt.V.Roz.upySmooth(:));
0276             vmax = nanmax(guiparams.gp_vmt.V.Roz.upySmooth(:));
0277         <span class="keyword">case</span> <span class="string">'secondary_roz_x'</span>
0278             vmin = nanmin(guiparams.gp_vmt.V.Roz.usxSmooth(:));
0279             vmax = nanmax(guiparams.gp_vmt.V.Roz.usxSmooth(:));
0280         <span class="keyword">case</span> <span class="string">'secondary_roz_y'</span>
0281             vmin = nanmin(guiparams.gp_vmt.V.Roz.usySmooth(:));
0282             vmax = nanmax(guiparams.gp_vmt.V.Roz.usySmooth(:));
0283         <span class="keyword">case</span> <span class="string">'backscatter'</span>
0284             vmin = nanmin(guiparams.gp_vmt.V.mcsBackSmooth(:));
0285             vmax = nanmax(guiparams.gp_vmt.V.mcsBackSmooth(:));
0286         <span class="keyword">case</span> <span class="string">'flowangle'</span>
0287             vmin = nanmin(guiparams.gp_vmt.V.mcsDirSmooth(:));
0288             vmax = nanmax(guiparams.gp_vmt.V.mcsDirSmooth(:));
0289     <span class="keyword">end</span>
0290     guiparams.min_velocity_mcs              = vmin;
0291     guiparams.max_velocity_mcs              = vmax;
0292     
0293     <span class="comment">% Ensure correct units</span>
0294     <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
0295         <span class="comment">% No further action</span>
0296     <span class="keyword">else</span>
0297         <span class="comment">%guiparams.min_velocity_planview = guiparams.min_velocity_planview*0.03281;</span>
0298         <span class="comment">%guiparams.max_velocity_planview = guiparams.max_velocity_planview*0.03281;</span>
0299         guiparams.min_velocity_mcs      = guiparams.min_velocity_mcs*0.03281;
0300         guiparams.max_velocity_mcs      = guiparams.max_velocity_mcs*0.03281;
0301     <span class="keyword">end</span>
0302     set(handles.MinVelocityMCS, <span class="string">'String'</span>, guiparams.min_velocity_mcs);
0303     set(handles.MaxVelocityMCS, <span class="string">'String'</span>, guiparams.max_velocity_mcs);
0304     
0305     <span class="comment">% Update the GUI:</span>
0306     <span class="comment">% ---------------</span>
0307     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setmcsoff'</span>)
0308 <span class="keyword">end</span>
0309 
0310 <span class="comment">% Re-store the Application data:</span>
0311 <span class="comment">% ------------------------------</span>
0312 setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0313 
0314 <span class="comment">% [EOF] UseDataLimitsMCS_Callback</span>
0315 
0316 
0317 <a name="_sub8" href="#_subfunctions" class="code">function MinVelocityMCS_Callback(hObject, eventdata, handles)</a>
0318 <span class="comment">% Get the Application data:</span>
0319 <span class="comment">% -------------------------</span>
0320 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0321 
0322 <span class="comment">% Get the new entry and make sure it is valid (numeric):</span>
0323 <span class="comment">% ----------------------------------------------------------------</span>
0324 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0325 is_a_number = ~isnan(new_value);
0326 
0327 <span class="comment">% Modify the Application data:</span>
0328 <span class="comment">% ----------------------------</span>
0329 <span class="keyword">if</span> is_a_number
0330     guiparams.min_velocity_mcs = new_value;
0331     
0332     <span class="comment">% Re-store the Application data:</span>
0333     <span class="comment">% ------------------------------</span>
0334     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0335     
0336 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0337     set(hObject,<span class="string">'String'</span>,guiparams.min_velocity_mcs)
0338 <span class="keyword">end</span>
0339 <span class="comment">% [EOF] MinVelocityMCS_Callback</span>
0340 
0341 
0342 
0343 
0344 <a name="_sub9" href="#_subfunctions" class="code">function MaxVelocityMCS_Callback(hObject, eventdata, handles)</a>
0345 <span class="comment">% Get the Application data:</span>
0346 <span class="comment">% -------------------------</span>
0347 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0348 
0349 <span class="comment">% Get the new entry and make sure it is valid (numeric):</span>
0350 <span class="comment">% ----------------------------------------------------------------</span>
0351 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0352 is_a_number = ~isnan(new_value);
0353 
0354 <span class="comment">% Modify the Application data:</span>
0355 <span class="comment">% ----------------------------</span>
0356 <span class="keyword">if</span> is_a_number
0357     guiparams.max_velocity_mcs = new_value;
0358     
0359     <span class="comment">% Re-store the Application data:</span>
0360     <span class="comment">% ------------------------------</span>
0361     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0362     
0363 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0364     set(hObject,<span class="string">'String'</span>,guiparams.max_velocity_mcs)
0365 <span class="keyword">end</span>
0366 <span class="comment">% [EOF] MaxVelocityMCS_Callback</span>
0367 
0368 
0369 
0370 <span class="comment">% --- Executes on selection change in ColormapMCS.</span>
0371 <a name="_sub10" href="#_subfunctions" class="code">function ColormapMCS_Callback(hObject, eventdata, handles)</a>
0372 <span class="comment">% Get the Application data:</span>
0373 <span class="comment">% -------------------------</span>
0374 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0375 guiprefs  = getappdata(handles.figure1,<span class="string">'guiprefs'</span>);
0376 
0377 <span class="comment">% Modify the Application data:</span>
0378 <span class="comment">% ----------------------------</span>
0379 idx_variable = get(hObject,<span class="string">'Value'</span>);
0380 guiparams.idx_colormap_mcs = idx_variable;
0381 guiparams.colormap_mcs = guiparams.colormaps_mcs(idx_variable).string;
0382 
0383 <span class="keyword">if</span> strcmpi(<span class="string">'Browse for more (cpt)...'</span>,guiparams.colormap_mcs)
0384     [FileName,PathName] = uigetfile(<span class="string">'*.cpt'</span>,<span class="string">'Select the cpt colormap file'</span>,<span class="keyword">...</span>
0385         fullfile(guiprefs.cpt_path,guiprefs.cpt_file));
0386     guiparams.cpt_mcs = fullfile(PathName,FileName);
0387     
0388     <span class="comment">% Update the preferences:</span>
0389     <span class="comment">% -----------------------</span>
0390     guiprefs.cpt_path = PathName;
0391     guiprefs.cpt_file = FileName;
0392     setappdata(handles.figure1,<span class="string">'guiprefs'</span>,guiprefs)
0393     <a href="#_sub22" class="code" title="subfunction store_prefs(hfigure,pref)">store_prefs</a>(handles.figure1,<span class="string">'cptmcs'</span>)
0394 <span class="keyword">end</span>
0395 
0396 <span class="comment">% Re-store the Application data:</span>
0397 <span class="comment">% ------------------------------</span>
0398 setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0399 
0400 <span class="comment">% [EOF] ColormapMCS_Callback</span>
0401 
0402 
0403 
0404 <a name="_sub11" href="#_subfunctions" class="code">function ReferenceVelocity_Callback(hObject, eventdata, handles)</a>
0405 <span class="comment">% Get the Application data:</span>
0406 <span class="comment">% -------------------------</span>
0407 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0408 
0409 <span class="comment">% Get the new entry and make sure it is valid (numeric, positive):</span>
0410 <span class="comment">% ----------------------------------------------------------------</span>
0411 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0412 is_a_number = ~isnan(new_value);
0413 is_positive = new_value&gt;=0;
0414 
0415 <span class="comment">% Modify the Application data:</span>
0416 <span class="comment">% ----------------------------</span>
0417 <span class="keyword">if</span> is_a_number &amp;&amp; is_positive
0418     guiparams.reference_velocity = new_value;
0419     
0420     <span class="comment">% Re-store the Application data:</span>
0421     <span class="comment">% ------------------------------</span>
0422     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0423     
0424 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0425     set(hObject,<span class="string">'String'</span>,guiparams.reference_velocity)
0426 <span class="keyword">end</span>
0427 <span class="comment">% [EOF] ReferenceVelocity_Callback</span>
0428 
0429 
0430 
0431 
0432 <span class="comment">% --- Executes on button press in UseDefaults.</span>
0433 <a name="_sub12" href="#_subfunctions" class="code">function UseDefaults_Callback(hObject, eventdata, handles)</a>
0434 <span class="comment">% Get the Application Data</span>
0435 <span class="comment">% ------------------------</span>
0436 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0437 
0438 <span class="comment">% Modify the Application data:</span>
0439 <span class="comment">% ----------------------------</span>
0440 guiparams.use_defaults = logical(get(hObject,<span class="string">'Value'</span>)); <span class="comment">% boolean</span>
0441 
0442 <span class="keyword">if</span> ~guiparams.use_defaults <span class="comment">% User wants to set limits</span>
0443     <span class="comment">% Update the GUI:</span>
0444     <span class="comment">% ---------------</span>
0445     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setrefon'</span>)
0446 <span class="keyword">else</span>
0447     [~,J] = ind2sub(size(guiparams.gp_vmt.V.vp(1,:)),find(~isnan(guiparams.gp_vmt.V.vp(1,:))==1));
0448     et = J(1):guiparams.gp_vmt.horizontal_vector_spacing:J(end);
0449     [r, ~]=size(guiparams.gp_vmt.V.vp);
0450     bi = 1:guiparams.gp_vmt.vertical_vector_spacing:r;
0451     <span class="keyword">switch</span> guiparams.gp_vmt.secondary_flow_vector_variable
0452         <span class="keyword">case</span> <span class="string">'transverse'</span>
0453             reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.vSmooth(bi,et)))));
0454         <span class="keyword">case</span> <span class="string">'secondary_zsd'</span>
0455             reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.vsSmooth(bi,et)))));
0456         <span class="keyword">case</span> <span class="string">'secondary_roz'</span>
0457             reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.usSmooth(bi,et)))));
0458         <span class="keyword">case</span> <span class="string">'secondary_roz_y'</span>
0459             reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.usySmooth(bi,et)))));
0460         <span class="keyword">case</span> <span class="string">'primary_roz_y'</span>
0461             reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.upySmooth(bi,et)))));
0462     <span class="keyword">end</span>
0463     
0464     distance = 0.06*max(guiparams.gp_vmt.V.mcsDist(:));
0465     depth    = 0.95*max(guiparams.gp_vmt.V.mcsBed(:));
0466     <span class="keyword">if</span> guiparams.gp_vmt.english_units
0467         reference_velocity = reference_velocity*0.03281; <span class="comment">% cm/s to ft/s</span>
0468         distance = distance*3.281;
0469         depth    = depth*3.281;
0470     <span class="keyword">end</span>
0471     
0472     
0473     set(handles.ReferenceVelocity, <span class="string">'String'</span>, num2str(reference_velocity))
0474     set(handles.Distance,          <span class="string">'String'</span>, num2str(distance))
0475     set(handles.Depth,             <span class="string">'String'</span>, num2str(depth))
0476     
0477     <span class="comment">% Re-store the Application data:</span>
0478     <span class="comment">% ------------------------------</span>
0479     guiparams.reference_velocity = reference_velocity;
0480     guiparams.distance           = distance;
0481     guiparams.depth              = depth;
0482     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0483     
0484     <span class="comment">% Update the GUI:</span>
0485     <span class="comment">% ---------------</span>
0486     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'setrefoff'</span>)
0487 <span class="keyword">end</span>
0488 
0489 
0490 <span class="comment">% [EOF] UseDefaults_Callback</span>
0491 
0492 
0493 <a name="_sub13" href="#_subfunctions" class="code">function Distance_Callback(hObject, eventdata, handles)</a>
0494 <span class="comment">% Get the Application data:</span>
0495 <span class="comment">% -------------------------</span>
0496 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0497 
0498 <span class="comment">% Get the new entry and make sure it is valid (numeric, positive):</span>
0499 <span class="comment">% ----------------------------------------------------------------</span>
0500 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0501 is_a_number = ~isnan(new_value);
0502 is_positive = new_value&gt;=0;
0503 
0504 <span class="comment">% Modify the Application data:</span>
0505 <span class="comment">% ----------------------------</span>
0506 <span class="keyword">if</span> is_a_number &amp;&amp; is_positive
0507     guiparams.distance = new_value;
0508     
0509     <span class="comment">% Re-store the Application data:</span>
0510     <span class="comment">% ------------------------------</span>
0511     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0512     
0513 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0514     set(hObject,<span class="string">'String'</span>,guiparams.distance)
0515 <span class="keyword">end</span>
0516 <span class="comment">% [EOF] Distance_Callback</span>
0517 
0518 
0519 
0520 
0521 
0522 <a name="_sub14" href="#_subfunctions" class="code">function Depth_Callback(hObject, eventdata, handles)</a>
0523 <span class="comment">% Get the Application data:</span>
0524 <span class="comment">% -------------------------</span>
0525 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0526 
0527 <span class="comment">% Get the new entry and make sure it is valid (numeric, positive):</span>
0528 <span class="comment">% ----------------------------------------------------------------</span>
0529 new_value = str2double(get(hObject,<span class="string">'String'</span>));
0530 is_a_number = ~isnan(new_value);
0531 is_positive = new_value&gt;=0;
0532 
0533 <span class="comment">% Modify the Application data:</span>
0534 <span class="comment">% ----------------------------</span>
0535 <span class="keyword">if</span> is_a_number &amp;&amp; is_positive
0536     guiparams.depth = new_value;
0537     
0538     <span class="comment">% Re-store the Application data:</span>
0539     <span class="comment">% ------------------------------</span>
0540     setappdata(handles.figure1,<span class="string">'guiparams'</span>,guiparams)
0541     
0542 <span class="keyword">else</span> <span class="comment">% Reject the (incorrect) input</span>
0543     set(hObject,<span class="string">'String'</span>,guiparams.depth)
0544 <span class="keyword">end</span>
0545 <span class="comment">% [EOF] Depth_Callback</span>
0546 
0547 
0548 
0549 
0550 <span class="comment">% --- Executes on button press in ApplyChanges.</span>
0551 <a name="_sub15" href="#_subfunctions" class="code">function ApplyChanges_Callback(hObject, eventdata, handles)</a>
0552 <span class="comment">% Get the Application data:</span>
0553 <span class="comment">% -------------------------</span>
0554 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0555 guiprefs  = getappdata(handles.figure1,<span class="string">'guiprefs'</span>);
0556 z   = guiparams.gp_vmt.z;
0557 A   = guiparams.gp_vmt.A;
0558 V   = guiparams.gp_vmt.V;
0559 Map = guiparams.gp_vmt.Map;
0560 
0561 <span class="comment">% See if PLOT 1 exists already, if so grab the handle.</span>
0562 fig_planview_handle = findobj(0,<span class="string">'name'</span>,<span class="string">'Plan View Map'</span>);
0563 
0564 <span class="comment">% If PLOT 1 exists, go ahead and apply any changes</span>
0565 <span class="keyword">if</span> ~isempty(fig_planview_handle) &amp;&amp;  ishandle(fig_planview_handle)
0566     figure(fig_planview_handle);
0567     <span class="comment">% Plot the data:</span>
0568     <span class="comment">% --------------</span>
0569     <span class="comment">%msgbox('Plotting Plan View','VMT Status','help','replace');</span>
0570     depth_range = [guiparams.gp_vmt.depth_range_min guiparams.gp_vmt.depth_range_max];
0571     
0572     minrng = guiparams.min_velocity_planview;
0573     maxrng = guiparams.max_velocity_planview;
0574     usecolormap = guiparams.colormap_planview;
0575     cptfullfile = guiparams.cpt_planview;
0576     [~,~,~] = VMT_PlotPlanViewQuivers(z,A,V,Map, <span class="keyword">...</span>
0577         depth_range, <span class="keyword">...</span>
0578         guiparams.gp_vmt.vector_scale_plan_view, <span class="keyword">...</span>
0579         guiparams.gp_vmt.vector_spacing_plan_view, <span class="keyword">...</span>
0580         guiparams.gp_vmt.smoothing_window_size, <span class="keyword">...</span>
0581         guiparams.gp_vmt.display_shoreline, <span class="keyword">...</span>
0582         guiparams.gp_vmt.english_units,<span class="keyword">...</span>
0583         guiparams.gp_vmt.mat_file, <span class="keyword">...</span>
0584         guiparams.gp_vmt.mat_path,<span class="keyword">...</span>
0585         guiparams.gp_vmt.plotref,<span class="keyword">...</span><span class="comment"> % PLOT2</span>
0586         minrng,<span class="keyword">...</span>
0587         maxrng,<span class="keyword">...</span>
0588         usecolormap,<span class="keyword">...</span>
0589         cptfullfile); <span class="comment">% PLOT2</span>
0590     
0591     <span class="comment">% Plot Shoreline</span>
0592     <span class="keyword">if</span> guiparams.gp_vmt.display_shoreline
0593         
0594         <span class="keyword">if</span> ischar(guiprefs.shoreline_file) <span class="comment">% User did not hit cancel</span>
0595             mapdata = dlmread(fullfile(guiprefs.shoreline_path,guiprefs.shoreline_file));
0596             Map.UTMe   = mapdata(:,1);
0597             Map.UTMn   = mapdata(:,2);
0598             Map.infile = fullfile(guiprefs.shoreline_path,guiprefs.shoreline_file);
0599             <span class="comment">%Map.UTMzone = zone;</span>
0600         <span class="keyword">else</span>
0601             Map = [];
0602         <span class="keyword">end</span>
0603         VMT_PlotShoreline(Map)
0604     <span class="keyword">end</span>
0605     
0606     <span class="comment">% Overlay DOQQ</span>
0607     <span class="keyword">if</span> guiparams.gp_vmt.add_background
0608         [~,~] = VMT_OverlayDOQQ(guiprefs,true);
0609     <span class="keyword">end</span>
0610 <span class="keyword">end</span>
0611 
0612 <span class="comment">% See if PLOT 3 exists already, if so clear the figure</span>
0613 fig_contour_handle = findobj(0,<span class="string">'name'</span>,<span class="string">'Mean Cross Section Contour'</span>);
0614 
0615 <span class="comment">% If PLOT 3 exists, go ahead and apply any changes</span>
0616 <span class="keyword">if</span> ~isempty(fig_contour_handle) &amp;&amp;  ishandle(fig_contour_handle)
0617     figure(fig_contour_handle);
0618     
0619     <span class="comment">% Modify reference vector, only if it's already being plotted</span>
0620     <span class="keyword">if</span> guiparams.gp_vmt.plot_secondary_flow_vectors
0621         <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
0622             [~,A,V,plot_cont_log_text] = VMT_PlotXSContQuiver(z,A,V, <span class="keyword">...</span>
0623                 guiparams.gp_vmt.contour, <span class="keyword">...</span>
0624                 guiparams.gp_vmt.vector_scale_cross_section, <span class="keyword">...</span>
0625                 guiparams.gp_vmt.vertical_exaggeration, <span class="keyword">...</span>
0626                 guiparams.gp_vmt.horizontal_vector_spacing, <span class="keyword">...</span>
0627                 guiparams.gp_vmt.vertical_vector_spacing, <span class="keyword">...</span>
0628                 guiparams.gp_vmt.secondary_flow_vector_variable, <span class="keyword">...</span>
0629                 guiparams.gp_vmt.include_vertical_velocity, <span class="keyword">...</span>
0630                 guiparams.gp_vmt.english_units,<span class="keyword">...</span>
0631                 guiparams.reference_velocity,<span class="keyword">...</span>
0632                 guiparams.distance,<span class="keyword">...</span>
0633                 guiparams.depth); <span class="comment">%#ok&lt;ASGLU&gt; % PLOT3</span>
0634         <span class="keyword">else</span>
0635             [~,A,V,plot_cont_log_text] = VMT_PlotXSContQuiver(z,A,V, <span class="keyword">...</span>
0636                 guiparams.gp_vmt.contour, <span class="keyword">...</span>
0637                 guiparams.gp_vmt.vector_scale_cross_section, <span class="keyword">...</span>
0638                 guiparams.gp_vmt.vertical_exaggeration, <span class="keyword">...</span>
0639                 guiparams.gp_vmt.horizontal_vector_spacing, <span class="keyword">...</span>
0640                 guiparams.gp_vmt.vertical_vector_spacing, <span class="keyword">...</span>
0641                 guiparams.gp_vmt.secondary_flow_vector_variable, <span class="keyword">...</span>
0642                 guiparams.gp_vmt.include_vertical_velocity, <span class="keyword">...</span>
0643                 guiparams.gp_vmt.english_units,<span class="keyword">...</span>
0644                 guiparams.reference_velocity.*30.48,<span class="keyword">...</span><span class="comment"> %cm/s</span>
0645                 guiparams.distance.*0.3048,<span class="keyword">...</span><span class="comment">          %m</span>
0646                 guiparams.depth.*0.3048); <span class="comment">%#ok&lt;ASGLU&gt; % PLOT3</span>
0647         <span class="keyword">end</span>
0648     <span class="keyword">end</span>
0649     
0650     <span class="comment">% Set data limits</span>
0651     caxis([
0652         guiparams.min_velocity_mcs
0653         guiparams.max_velocity_mcs])
0654     
0655     <span class="comment">% Apply the color map</span>
0656     <span class="keyword">if</span> ~strcmpi(<span class="string">'Browse for more (cpt)...'</span>,guiparams.colormap_mcs)
0657         colormap(guiparams.colormap_mcs)
0658     <span class="keyword">else</span>
0659         <a href="cptcmap.html" class="code" title="function varargout = cptcmap(varargin)">cptcmap</a>(guiparams.cpt_mcs)
0660     <span class="keyword">end</span>
0661 <span class="keyword">end</span>
0662 
0663 <span class="comment">% Force plots to be formated properly</span>
0664 <span class="comment">% -----------------------------------</span>
0665 <span class="keyword">if</span> guiparams.gp_vmt.presentation
0666     <a href="#_sub20" class="code" title="subfunction UpdatePlotStyle(hObject, eventdata, handles)">UpdatePlotStyle</a>(hObject, eventdata, handles)
0667 <span class="keyword">else</span>
0668     <a href="#_sub20" class="code" title="subfunction UpdatePlotStyle(hObject, eventdata, handles)">UpdatePlotStyle</a>(hObject, eventdata, handles)
0669 <span class="keyword">end</span>
0670 <span class="comment">% [EOF] ApplyChanges_Callback</span>
0671 
0672 
0673 <span class="comment">% --- Executes on button press in Close.</span>
0674 <a name="_sub16" href="#_subfunctions" class="code">function Close_Callback(hObject, eventdata, handles)</a>
0675 
0676 close(handles.figure1)
0677 
0678 <span class="comment">% [EOF] Close_Callback</span>
0679 
0680 <span class="comment">% --------------------------------------------------------------------</span>
0681 <a name="_sub17" href="#_subfunctions" class="code">function initGUI(handles)</a>
0682 <span class="comment">% Initialize the UI controls in the GUI.</span>
0683 
0684 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
0685 
0686 <span class="comment">% Plan View Map Panel</span>
0687 set(handles.UseDataLimitsPlanview,    <span class="string">'Value'</span>,  guiparams.use_data_limits_planview);
0688 set(handles.MinVelocityPlanview,      <span class="string">'String'</span>, guiparams.min_velocity_planview);
0689 set(handles.MinVelocityPlanviewUnits, <span class="string">'String'</span>, guiparams.min_velocity_planview_units);
0690 set(handles.MaxVelocityPlanview,      <span class="string">'String'</span>, guiparams.max_velocity_planview);
0691 set(handles.MaxVelocityPlanviewUnits, <span class="string">'String'</span>, guiparams.max_velocity_planview_units);
0692 set(handles.ColormapPlanview,         <span class="string">'String'</span>,{guiparams.colormaps_planview.string}, <span class="keyword">...</span>
0693     <span class="string">'Value'</span>, guiparams.idx_colormap_planview)
0694 
0695 <span class="comment">% Mean Cross Section Contours</span>
0696 set(handles.UseDataLimitsMCS,           <span class="string">'Value'</span>,  guiparams.use_data_limits_mcs);
0697 set(handles.MinVelocityMCS,             <span class="string">'String'</span>, guiparams.min_velocity_mcs);
0698 set(handles.MinVelocityMCSUnits,        <span class="string">'String'</span>, guiparams.min_velocity_mcs_units);
0699 set(handles.MaxVelocityMCS,             <span class="string">'String'</span>, guiparams.max_velocity_mcs);
0700 set(handles.MaxVelocityMCSUnits,        <span class="string">'String'</span>, guiparams.max_velocity_mcs_units);
0701 set(handles.UseDefaults,                <span class="string">'Value'</span>,  guiparams.use_defaults);
0702 set(handles.ReferenceVelocity,          <span class="string">'String'</span>, guiparams.reference_velocity);
0703 set(handles.ReferenceVelocityUnits,     <span class="string">'String'</span>, guiparams.reference_velocity_units);
0704 set(handles.Distance,                   <span class="string">'String'</span>, guiparams.distance);
0705 set(handles.DistanceUnits,              <span class="string">'String'</span>, guiparams.distance_units);
0706 set(handles.Depth,                      <span class="string">'String'</span>, guiparams.depth);
0707 set(handles.DepthUnits,                 <span class="string">'String'</span>, guiparams.depth_units);
0708 set(handles.ColormapMCS,                <span class="string">'String'</span>,{guiparams.colormaps_mcs.string}, <span class="keyword">...</span>
0709     <span class="string">'Value'</span>, guiparams.idx_colormap_mcs);
0710 
0711 <span class="comment">% Update the GUI:</span>
0712 <span class="comment">% ---------------</span>
0713 <span class="keyword">if</span> iscell(guiparams.gp_vmt.mat_file) <span class="comment">% Multiple mat files loaded</span>
0714     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'initmultiple'</span>)
0715 <span class="keyword">else</span>
0716     <a href="#_sub19" class="code" title="subfunction set_enable(handles,enable_state)">set_enable</a>(handles,<span class="string">'init'</span>)
0717 <span class="keyword">end</span>
0718 <span class="comment">% [EOF] initGUI</span>
0719 
0720 <a name="_sub18" href="#_subfunctions" class="code">function [guiparams] = createGUIparams</a>
0721 
0722 <span class="comment">% Get the VMT current state for use by the sub-GUI</span>
0723 <span class="comment">% ------------------------------------------------</span>
0724 hVMTgui                 = getappdata(0,<span class="string">'hVMTgui'</span>);
0725 guiparams_vmt           = getappdata(hVMTgui,<span class="string">'guiparams'</span>);
0726 guiparams.gp_vmt        = guiparams_vmt;
0727 
0728 <span class="comment">% Check to see what plots already exist</span>
0729 <span class="comment">% -------------------------------------</span>
0730 fig_planview_handle = findobj(0,<span class="string">'name'</span>,<span class="string">'Plan View Map'</span>);
0731 fig_mcs_handle = findobj(0,<span class="string">'name'</span>,<span class="string">'Mean Cross Section Contour'</span>);
0732 <span class="comment">% if ~isempty(fig_planview_handle) &amp;&amp;  ishandle(fig_planview_handle)</span>
0733 <span class="comment">%     figure(fig_planview_handle); clf</span>
0734 <span class="comment">% else</span>
0735 <span class="comment">%     fig_planview_handle = figure('name','Plan View Map'); clf</span>
0736 <span class="comment">%     %set(gca,'DataAspectRatio',[1 1 1],'PlotBoxAspectRatio',[1 1 1])</span>
0737 <span class="comment">% end</span>
0738 
0739 <span class="comment">%%%%%%%%%%%%%%%%%</span>
0740 <span class="comment">% Plan View Map %</span>
0741 <span class="comment">%%%%%%%%%%%%%%%%%</span>
0742 guiparams.use_data_limits_planview      = 1;
0743 
0744 <span class="keyword">if</span> ~isempty(fig_planview_handle) &amp;&amp; ishandle(fig_planview_handle)
0745     <span class="comment">% Compute the data limits to populate edit boxes</span>
0746     PVdata = guiparams.gp_vmt.iric_anv_planview_data.outmat';
0747     PVdata(:,4:5) = PVdata(:,4:5).*100; <span class="comment">% in cm/s</span>
0748     vr = sqrt(PVdata(:,4).^2+PVdata(:,5).^2);
0749     guiparams.min_velocity_planview  = nanmin(vr);
0750     guiparams.max_velocity_planview  = nanmax(vr);
0751 <span class="keyword">else</span>
0752     guiparams.min_velocity_planview  = 0;
0753     guiparams.max_velocity_planview  = 0;
0754 <span class="keyword">end</span>
0755 
0756 <span class="comment">% Colormap choices</span>
0757 guiparams.idx_colormap_planview  = 1;
0758 idx = 1;
0759 guiparams.colormaps_planview(idx).string   = <span class="string">'Jet'</span>;
0760 idx = idx + 1;
0761 guiparams.colormaps_planview(idx).string   = <span class="string">'HSV'</span>;
0762 idx = idx + 1;
0763 guiparams.colormaps_planview(idx).string   = <span class="string">'Hot'</span>;
0764 idx = idx + 1;
0765 guiparams.colormaps_planview(idx).string   = <span class="string">'Cool'</span>;
0766 idx = idx + 1;
0767 guiparams.colormaps_planview(idx).string   = <span class="string">'Spring'</span>;
0768 idx = idx + 1;
0769 guiparams.colormaps_planview(idx).string   = <span class="string">'Summer'</span>;
0770 idx = idx + 1;
0771 guiparams.colormaps_planview(idx).string   = <span class="string">'Autumn'</span>;
0772 idx = idx + 1;
0773 guiparams.colormaps_planview(idx).string   = <span class="string">'Winter'</span>;
0774 idx = idx + 1;
0775 guiparams.colormaps_planview(idx).string   = <span class="string">'Gray'</span>;
0776 idx = idx + 1;
0777 guiparams.colormaps_planview(idx).string   = <span class="string">'Bone'</span>;
0778 idx = idx + 1;
0779 guiparams.colormaps_planview(idx).string   = <span class="string">'Copper'</span>;
0780 idx = idx + 1;
0781 guiparams.colormaps_planview(idx).string   = <span class="string">'Pink'</span>;
0782 idx = idx + 1;
0783 guiparams.colormaps_planview(idx).string   = <span class="string">'Browse for more (cpt)...'</span>;
0784 guiparams.colormap_planview = <span class="keyword">...</span>
0785     guiparams.colormaps_planview(guiparams.idx_colormap_planview).string;
0786 guiparams.cpt_planview                     = [];
0787 
0788 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0789 <span class="comment">% Mean Cross Section Contours %</span>
0790 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0791 guiparams.use_data_limits_mcs           = 1;
0792 guiparams.use_defaults                  = 1;
0793 
0794 <span class="keyword">if</span> ~isempty(fig_mcs_handle) &amp;&amp; ishandle(fig_mcs_handle)
0795 <span class="keyword">if</span> iscell(guiparams.gp_vmt.mat_file) <span class="comment">% Multiple mat files loaded</span>
0796     guiparams.min_velocity_mcs   = 0;
0797     guiparams.max_velocity_mcs   = 0;
0798     guiparams.distance           = 0;
0799     guiparams.depth              = 0;
0800     guiparams.reference_velocity = 0; <span class="comment">% cm/s to ft/s</span>
0801 <span class="keyword">else</span>
0802     <span class="comment">% Compute the data limits for the edit box, based on the currently selected</span>
0803     <span class="comment">% contour plot variable</span>
0804     <span class="keyword">switch</span> guiparams.gp_vmt.contour
0805         <span class="keyword">case</span> <span class="string">'streamwise'</span>
0806             vmin = nanmin(guiparams.gp_vmt.V.uSmooth(:));
0807             vmax = nanmax(guiparams.gp_vmt.V.uSmooth(:));
0808         <span class="keyword">case</span> <span class="string">'transverse'</span>
0809             vmin = nanmin(guiparams.gp_vmt.V.vSmooth(:));
0810             vmax = nanmax(guiparams.gp_vmt.V.vSmooth(:));
0811         <span class="keyword">case</span> <span class="string">'vertical'</span>
0812             vmin = nanmin(guiparams.gp_vmt.V.wSmooth(:));
0813             vmax = nanmax(guiparams.gp_vmt.V.wSmooth(:));
0814         <span class="keyword">case</span> <span class="string">'mag'</span>
0815             vmin = nanmin(guiparams.gp_vmt.V.mcsMagSmooth(:));
0816             vmax = nanmax(guiparams.gp_vmt.V.mcsMagSmooth(:));
0817         <span class="keyword">case</span> <span class="string">'east'</span>
0818             vmin = nanmin(guiparams.gp_vmt.V.mcsMagSmooth(:));
0819             vmax = nanmax(guiparams.gp_vmt.V.mcsMagSmooth(:));
0820         <span class="keyword">case</span> <span class="string">'north'</span>
0821             vmin = nanmin(guiparams.gp_vmt.V.mcsEastSmooth(:));
0822             vmax = nanmax(guiparams.gp_vmt.V.mcsNorthSmooth(:));
0823         <span class="keyword">case</span> <span class="string">'error'</span>
0824             vmin = nanmin(guiparams.gp_vmt.V.mcsError(:));
0825             vmax = nanmax(guiparams.gp_vmt.V.mcsError(:));
0826         <span class="keyword">case</span> <span class="string">'primary_zsd'</span>
0827             vmin = nanmin(guiparams.gp_vmt.V.vpSmooth(:));
0828             vmax = nanmax(guiparams.gp_vmt.V.vpSmooth(:));
0829         <span class="keyword">case</span> <span class="string">'secondary_zsd'</span>
0830             vmin = nanmin(guiparams.gp_vmt.V.vsSmooth(:));
0831             vmax = nanmax(guiparams.gp_vmt.V.vsSmooth(:));
0832         <span class="keyword">case</span> <span class="string">'primary_roz'</span>
0833             vmin = nanmin(guiparams.gp_vmt.V.Roz.upSmooth(:));
0834             vmax = nanmax(guiparams.gp_vmt.V.Roz.upSmooth(:));
0835         <span class="keyword">case</span> <span class="string">'secondary_roz'</span>
0836             vmin = nanmin(guiparams.gp_vmt.V.Roz.usSmooth(:));
0837             vmax = nanmax(guiparams.gp_vmt.V.Roz.usSmooth(:));
0838         <span class="keyword">case</span> <span class="string">'primary_roz_x'</span>
0839             vmin = nanmin(guiparams.gp_vmt.V.Roz.upxSmooth(:));
0840             vmax = nanmax(guiparams.gp_vmt.V.Roz.upxSmooth(:));
0841         <span class="keyword">case</span> <span class="string">'primary_roz_y'</span>
0842             vmin = nanmin(guiparams.gp_vmt.V.Roz.upySmooth(:));
0843             vmax = nanmax(guiparams.gp_vmt.V.Roz.upySmooth(:));
0844         <span class="keyword">case</span> <span class="string">'secondary_roz_x'</span>
0845             vmin = nanmin(guiparams.gp_vmt.V.Roz.usxSmooth(:));
0846             vmax = nanmax(guiparams.gp_vmt.V.Roz.usxSmooth(:));
0847         <span class="keyword">case</span> <span class="string">'secondary_roz_y'</span>
0848             vmin = nanmin(guiparams.gp_vmt.V.Roz.usySmooth(:));
0849             vmax = nanmax(guiparams.gp_vmt.V.Roz.usySmooth(:));
0850         <span class="keyword">case</span> <span class="string">'backscatter'</span>
0851             vmin = nanmin(guiparams.gp_vmt.V.mcsBackSmooth(:));
0852             vmax = nanmax(guiparams.gp_vmt.V.mcsBackSmooth(:));
0853         <span class="keyword">case</span> <span class="string">'flowangle'</span>
0854             vmin = nanmin(guiparams.gp_vmt.V.mcsDirSmooth(:));
0855             vmax = nanmax(guiparams.gp_vmt.V.mcsDirSmooth(:));
0856         <span class="keyword">case</span> <span class="string">'vorticity_vw'</span>
0857             vmin = nanmin(guiparams.gp_vmt.V.vorticity_vw(:));
0858             vmax = nanmax(guiparams.gp_vmt.V.vorticity_vw(:));
0859         <span class="keyword">case</span> <span class="string">'vorticity_zsd'</span>
0860             vmin = nanmin(guiparams.gp_vmt.V.vorticity_zsd(:));
0861             vmax = nanmax(guiparams.gp_vmt.V.vorticity_zsd(:));
0862         <span class="keyword">case</span> <span class="string">'vorticity_roz'</span>
0863             vmin = nanmin(guiparams.gp_vmt.V.vorticity_roz(:));
0864             vmax = nanmax(guiparams.gp_vmt.V.vorticity_roz(:));
0865     <span class="keyword">end</span>
0866     guiparams.min_velocity_mcs              = vmin;
0867     guiparams.max_velocity_mcs              = vmax;
0868     
0869     <span class="comment">% Reference arrow</span>
0870     <span class="comment">% Find first full row of data. Typically this is row 1 with RG data,</span>
0871     <span class="comment">% however it may not be for M9 and/or RR data.</span>
0872     i = 1;
0873     <span class="keyword">while</span> any(isnan(guiparams.gp_vmt.V.vp(i,:)))
0874         i=i+1;
0875         <span class="keyword">if</span> i &gt; size(guiparams.gp_vmt.V.vp,1)
0876             <span class="keyword">break</span>
0877         <span class="keyword">end</span>
0878     <span class="keyword">end</span>
0879     <span class="comment">% If a bad ensemble exists, the above while loop might not find a</span>
0880     <span class="comment">% result. If that happens, just use row 1 anyway</span>
0881 <span class="comment">%     try</span>
0882 <span class="comment">%         [I,J] = ind2sub(size(guiparams.gp_vmt.V.vp(i,:)),find(~isnan(guiparams.gp_vmt.V.vp(i,:))==1));</span>
0883 <span class="comment">%     catch err</span>
0884 <span class="comment">%         [I,J] = ind2sub(size(guiparams.gp_vmt.V.vp(1,:)),find(~isnan(guiparams.gp_vmt.V.vp(1,:))==1));</span>
0885 <span class="comment">%     end</span>
0886     
0887     <span class="comment">% Find first full row of data. Typically this is row 1 with RG data,</span>
0888     <span class="comment">% however it may not be for M9 and/or RR data.</span>
0889     i = 1;
0890     <span class="keyword">while</span> any(isnan(guiparams.gp_vmt.V.vp(i,:)))
0891         i=i+1;
0892         <span class="keyword">if</span> i &gt; size(guiparams.gp_vmt.V.vp,1)
0893             <span class="keyword">break</span>
0894         <span class="keyword">end</span>
0895     <span class="keyword">end</span>
0896     i=5; <span class="comment">% This is a temporary fix</span>
0897     <span class="comment">% If a bad ensemble exists, the above while loop might not find a</span>
0898     <span class="comment">% result. If that happens, just use row 1 anyway</span>
0899     <span class="keyword">try</span>
0900         [I,J] = ind2sub(size(guiparams.gp_vmt.V.vp(i,:)),find(~isnan(guiparams.gp_vmt.V.vp(i,:))==1));
0901     <span class="keyword">catch</span> err
0902         [I,J] = ind2sub(size(guiparams.gp_vmt.V.vp(1,:)),find(~isnan(guiparams.gp_vmt.V.vp(1,:))==1));
0903     <span class="keyword">end</span>
0904     
0905     et = J(1):guiparams.gp_vmt.horizontal_vector_spacing:J(end);
0906     [r, ~]=size(guiparams.gp_vmt.V.vp);
0907     bi = 1:guiparams.gp_vmt.vertical_vector_spacing:r;
0908     <span class="keyword">switch</span> guiparams.gp_vmt.secondary_flow_vector_variable
0909         <span class="keyword">case</span> <span class="string">'transverse'</span>
0910             guiparams.reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.vSmooth(bi,et)))));
0911         <span class="keyword">case</span> <span class="string">'secondary_zsd'</span>
0912             guiparams.reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.vsSmooth(bi,et)))));
0913         <span class="keyword">case</span> <span class="string">'secondary_roz'</span>
0914             guiparams.reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.usSmooth(bi,et)))));
0915         <span class="keyword">case</span> <span class="string">'secondary_roz_y'</span>
0916             guiparams.reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.usySmooth(bi,et)))));
0917         <span class="keyword">case</span> <span class="string">'primary_roz_y'</span>
0918             guiparams.reference_velocity = ceil(max(max(abs(guiparams.gp_vmt.V.Roz.upySmooth(bi,et)))));
0919     <span class="keyword">end</span>
0920     
0921     guiparams.distance = 0.06*max(guiparams.gp_vmt.V.mcsDist(:));
0922     guiparams.depth    = 0.95*max(guiparams.gp_vmt.V.mcsBed(:));
0923     <span class="keyword">if</span> guiparams.gp_vmt.english_units
0924         guiparams.reference_velocity = guiparams.reference_velocity*0.03281; <span class="comment">% cm/s to ft/s</span>
0925         guiparams.distance           = guiparams.distance*3.281;
0926         guiparams.depth              = guiparams.depth*3.281;
0927     <span class="keyword">end</span>
0928 <span class="keyword">end</span>
0929 <span class="keyword">else</span>
0930     guiparams.min_velocity_mcs   = 0;
0931     guiparams.max_velocity_mcs   = 0;
0932     guiparams.distance           = 0;
0933     guiparams.depth              = 0;
0934     guiparams.reference_velocity = 0; <span class="comment">% cm/s to ft/s</span>
0935 <span class="keyword">end</span>
0936 
0937 guiparams.idx_colormap_mcs              = 1;
0938 
0939 <span class="comment">% Colormap choices</span>
0940 idx = 1;
0941 guiparams.colormaps_mcs(idx).string   = <span class="string">'Jet'</span>;
0942 idx = idx + 1;
0943 guiparams.colormaps_mcs(idx).string   = <span class="string">'HSV'</span>;
0944 idx = idx + 1;
0945 guiparams.colormaps_mcs(idx).string   = <span class="string">'Hot'</span>;
0946 idx = idx + 1;
0947 guiparams.colormaps_mcs(idx).string   = <span class="string">'Cool'</span>;
0948 idx = idx + 1;
0949 guiparams.colormaps_mcs(idx).string   = <span class="string">'Spring'</span>;
0950 idx = idx + 1;
0951 guiparams.colormaps_mcs(idx).string   = <span class="string">'Summer'</span>;
0952 idx = idx + 1;
0953 guiparams.colormaps_mcs(idx).string   = <span class="string">'Autumn'</span>;
0954 idx = idx + 1;
0955 guiparams.colormaps_mcs(idx).string   = <span class="string">'Winter'</span>;
0956 idx = idx + 1;
0957 guiparams.colormaps_mcs(idx).string   = <span class="string">'Gray'</span>;
0958 idx = idx + 1;
0959 guiparams.colormaps_mcs(idx).string   = <span class="string">'Bone'</span>;
0960 idx = idx + 1;
0961 guiparams.colormaps_mcs(idx).string   = <span class="string">'Copper'</span>;
0962 idx = idx + 1;
0963 guiparams.colormaps_mcs(idx).string   = <span class="string">'Pink'</span>;
0964 idx = idx + 1;
0965 guiparams.colormaps_mcs(idx).string   = <span class="string">'Browse for more (cpt)...'</span>;
0966 guiparams.colormap_mcs = <span class="keyword">...</span>
0967     guiparams.colormaps_mcs(guiparams.idx_colormap_mcs).string;
0968 guiparams.cpt_mcs                      = [];
0969 
0970 <span class="comment">% Set the units</span>
0971 <span class="keyword">switch</span> guiparams.gp_vmt.contour
0972     <span class="keyword">case</span> <span class="string">'backscatter'</span>
0973         guiparams.min_velocity_mcs_units   = <span class="string">'dB'</span>;
0974         guiparams.max_velocity_mcs_units   = <span class="string">'dB'</span>;
0975         <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
0976             guiparams.min_velocity_planview_units   = <span class="string">'cm/s'</span>;
0977             guiparams.max_velocity_planview_units   = <span class="string">'cm/s'</span>;
0978             <span class="comment">%guiparams.min_velocity_mcs_units        = 'cm/s';</span>
0979             <span class="comment">%guiparams.max_velocity_mcs_units        = 'cm/s';</span>
0980             guiparams.reference_velocity_units      = <span class="string">'cm/s'</span>;
0981             guiparams.distance_units                = <span class="string">'m'</span>;
0982             guiparams.depth_units                   = <span class="string">'m'</span>;
0983         <span class="keyword">else</span>
0984             guiparams.min_velocity_planview_units   = <span class="string">'ft/s'</span>;
0985             guiparams.max_velocity_planview_units   = <span class="string">'ft/s'</span>;
0986             <span class="comment">%guiparams.min_velocity_mcs_units        = 'ft/s';</span>
0987             <span class="comment">%guiparams.max_velocity_mcs_units        = 'ft/s';</span>
0988             guiparams.reference_velocity_units      = <span class="string">'ft/s'</span>;
0989             guiparams.distance_units                = <span class="string">'ft'</span>;
0990             guiparams.depth_units                   = <span class="string">'ft'</span>;
0991         <span class="keyword">end</span>
0992     <span class="keyword">case</span> <span class="string">'flowangle'</span>
0993         guiparams.min_velocity_mcs_units   = <span class="string">'deg'</span>;
0994         guiparams.max_velocity_mcs_units   = <span class="string">'deg'</span>;
0995         <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
0996             guiparams.min_velocity_planview_units   = <span class="string">'cm/s'</span>;
0997             guiparams.max_velocity_planview_units   = <span class="string">'cm/s'</span>;
0998             <span class="comment">%guiparams.min_velocity_mcs_units        = 'cm/s';</span>
0999             <span class="comment">%guiparams.max_velocity_mcs_units        = 'cm/s';</span>
1000             guiparams.reference_velocity_units      = <span class="string">'cm/s'</span>;
1001             guiparams.distance_units                = <span class="string">'m'</span>;
1002             guiparams.depth_units                   = <span class="string">'m'</span>;
1003         <span class="keyword">else</span>
1004             guiparams.min_velocity_planview_units   = <span class="string">'ft/s'</span>;
1005             guiparams.max_velocity_planview_units   = <span class="string">'ft/s'</span>;
1006             <span class="comment">%guiparams.min_velocity_mcs_units        = 'ft/s';</span>
1007             <span class="comment">%guiparams.max_velocity_mcs_units        = 'ft/s';</span>
1008             guiparams.reference_velocity_units      = <span class="string">'ft/s'</span>;
1009             guiparams.distance_units                = <span class="string">'ft'</span>;
1010             guiparams.depth_units                   = <span class="string">'ft'</span>;
1011         <span class="keyword">end</span>
1012     <span class="keyword">otherwise</span>
1013         <span class="keyword">if</span> ~guiparams.gp_vmt.english_units
1014             guiparams.min_velocity_planview_units   = <span class="string">'cm/s'</span>;
1015             guiparams.max_velocity_planview_units   = <span class="string">'cm/s'</span>;
1016             
1017             guiparams.min_velocity_mcs_units        = <span class="string">'cm/s'</span>;
1018             guiparams.max_velocity_mcs_units        = <span class="string">'cm/s'</span>;
1019             guiparams.reference_velocity_units      = <span class="string">'cm/s'</span>;
1020             guiparams.distance_units                = <span class="string">'m'</span>;
1021             guiparams.depth_units                   = <span class="string">'m'</span>;
1022         <span class="keyword">else</span>
1023             guiparams.min_velocity_planview_units   = <span class="string">'ft/s'</span>;
1024             guiparams.max_velocity_planview_units   = <span class="string">'ft/s'</span>;
1025             
1026             guiparams.min_velocity_mcs_units        = <span class="string">'ft/s'</span>;
1027             guiparams.max_velocity_mcs_units        = <span class="string">'ft/s'</span>;
1028             guiparams.reference_velocity_units      = <span class="string">'ft/s'</span>;
1029             guiparams.distance_units                = <span class="string">'ft'</span>;
1030             guiparams.depth_units                   = <span class="string">'ft'</span>;
1031             
1032             guiparams.min_velocity_planview = guiparams.min_velocity_planview*0.03281;
1033             guiparams.max_velocity_planview = guiparams.max_velocity_planview*0.03281;
1034             guiparams.min_velocity_mcs      = guiparams.min_velocity_mcs*0.03281;
1035             guiparams.max_velocity_mcs      = guiparams.max_velocity_mcs*0.03281;
1036         <span class="keyword">end</span>
1037 <span class="keyword">end</span>
1038 <span class="comment">% [EOF] createGUIparams</span>
1039 
1040 <span class="comment">% --------------------------------------------------------------------</span>
1041 <a name="_sub19" href="#_subfunctions" class="code">function set_enable(handles,enable_state)</a>
1042 
1043 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
1044 
1045 <span class="keyword">switch</span> enable_state
1046     <span class="keyword">case</span> <span class="string">'init'</span>
1047         <span class="comment">% Plan View Map Panel</span>
1048         set([handles.UseDataLimitsPlanview
1049             handles.ColormapPlanview],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1050         set([handles.MinVelocityPlanview
1051             handles.MinVelocityPlanviewUnits
1052             handles.MaxVelocityPlanview
1053             handles.MaxVelocityPlanviewUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1054         
1055         <span class="comment">% Mean Cross Section Contours</span>
1056         set([handles.UseDataLimitsMCS
1057             handles.UseDefaults
1058             handles.ColormapMCS],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1059         set([handles.MinVelocityMCS
1060             handles.MinVelocityMCSUnits
1061             handles.MaxVelocityMCS
1062             handles.MaxVelocityMCSUnits
1063             handles.ReferenceVelocity
1064             handles.ReferenceVelocityUnits
1065             handles.Distance
1066             handles.DistanceUnits
1067             handles.Depth
1068             handles.DepthUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1069     <span class="keyword">case</span> <span class="string">'initmultiple'</span>
1070         <span class="comment">% Plan View Map Panel</span>
1071         set([handles.UseDataLimitsPlanview
1072             handles.ColormapPlanview],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1073         set([handles.MinVelocityPlanview
1074             handles.MinVelocityPlanviewUnits
1075             handles.MaxVelocityPlanview
1076             handles.MaxVelocityPlanviewUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1077         
1078         <span class="comment">% Mean Cross Section Contours</span>
1079         set([handles.UseDataLimitsMCS
1080             handles.UseDefaults
1081             handles.ColormapMCS],<span class="string">'Enable'</span>, <span class="string">'off'</span>);
1082         set([handles.MinVelocityMCS
1083             handles.MinVelocityMCSUnits
1084             handles.MaxVelocityMCS
1085             handles.MaxVelocityMCSUnits
1086             handles.ReferenceVelocity
1087             handles.ReferenceVelocityUnits
1088             handles.Distance
1089             handles.DistanceUnits
1090             handles.Depth
1091             handles.DepthUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1092     <span class="keyword">case</span> <span class="string">'setplanviewon'</span>
1093         <span class="comment">% Plan View Map Panel</span>
1094         set([handles.UseDataLimitsPlanview
1095             handles.ColormapPlanview],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1096         set([handles.MinVelocityPlanview
1097             handles.MinVelocityPlanviewUnits
1098             handles.MaxVelocityPlanview
1099             handles.MaxVelocityPlanviewUnits], <span class="string">'Enable'</span>, <span class="string">'on'</span>);
1100     <span class="keyword">case</span> <span class="string">'setplanviewoff'</span>
1101         <span class="comment">% Plan View Map Panel</span>
1102         set([handles.UseDataLimitsPlanview
1103             handles.ColormapPlanview],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1104         set([handles.MinVelocityPlanview
1105             handles.MinVelocityPlanviewUnits
1106             handles.MaxVelocityPlanview
1107             handles.MaxVelocityPlanviewUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1108     <span class="keyword">case</span> <span class="string">'setmcson'</span>
1109         <span class="comment">% Mean Cross Section Contours</span>
1110         set([handles.UseDataLimitsMCS
1111             handles.ColormapMCS],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1112         set([handles.MinVelocityMCS
1113             handles.MinVelocityMCSUnits
1114             handles.MaxVelocityMCS
1115             handles.MaxVelocityMCSUnits
1116             ], <span class="string">'Enable'</span>, <span class="string">'on'</span>);
1117     <span class="keyword">case</span> <span class="string">'setmcsoff'</span>
1118         <span class="comment">% Mean Cross Section Contours</span>
1119         set([handles.UseDataLimitsMCS
1120             handles.ColormapMCS],<span class="string">'Enable'</span>, <span class="string">'on'</span>);
1121         set([handles.MinVelocityMCS
1122             handles.MinVelocityMCSUnits
1123             handles.MaxVelocityMCS
1124             handles.MaxVelocityMCSUnits
1125             ], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1126     <span class="keyword">case</span> <span class="string">'setrefon'</span>
1127         set([handles.ReferenceVelocity
1128             handles.ReferenceVelocityUnits
1129             handles.Distance
1130             handles.DistanceUnits
1131             handles.Depth
1132             handles.DepthUnits], <span class="string">'Enable'</span>, <span class="string">'on'</span>);
1133     <span class="keyword">case</span> <span class="string">'setrefoff'</span>
1134         set([handles.ReferenceVelocity
1135             handles.ReferenceVelocityUnits
1136             handles.Distance
1137             handles.DistanceUnits
1138             handles.Depth
1139             handles.DepthUnits], <span class="string">'Enable'</span>, <span class="string">'off'</span>);
1140     <span class="keyword">otherwise</span>
1141 <span class="keyword">end</span>
1142 <span class="comment">% [EOF] set_enable</span>
1143 
1144 <span class="comment">% --------------------------------------------------------------------</span>
1145 <a name="_sub20" href="#_subfunctions" class="code">function UpdatePlotStyle(hObject, eventdata, handles)</a>
1146 <span class="comment">% Get the Application Data:</span>
1147 <span class="comment">% -------------------------</span>
1148 guiparams = getappdata(handles.figure1,<span class="string">'guiparams'</span>);
1149 
1150 <span class="comment">% Modify the existing figures</span>
1151 <span class="comment">% ---------------------------</span>
1152 <span class="comment">% Find what plots exist already</span>
1153 hf = findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>);
1154 valid_names = {<span class="string">'Plan View Map'</span>; <span class="string">'Mean Cross Section Contour'</span>};
1155 
1156 <span class="keyword">if</span> guiparams.gp_vmt.presentation
1157     <span class="comment">% Defaults for Presentation Stlye Figure</span>
1158     BkgdColor   = <span class="string">'black'</span>;
1159     AxColor     = <span class="string">'white'</span>;
1160     FigColor    = <span class="string">'black'</span>; <span class="comment">% [0.3 0.3 0.3]</span>
1161     FntSize     = 14;
1162 <span class="keyword">else</span>
1163     <span class="comment">% Defaults for Print Stlye Figure</span>
1164     BkgdColor   = <span class="string">'white'</span>;
1165     AxColor     = <span class="string">'black'</span>;
1166     FigColor    = <span class="string">'white'</span>; <span class="comment">% [0.3 0.3 0.3]</span>
1167     FntSize     = 14;
1168 <span class="keyword">end</span>
1169 <span class="comment">% Loop through valid figures and adjust</span>
1170 <span class="comment">% -------------------------------------</span>
1171 <span class="keyword">if</span> ~isempty(hf) &amp;&amp;  any(ishandle(hf))
1172     
1173     <span class="keyword">for</span> i = 1:length(valid_names)
1174         <span class="keyword">switch</span> valid_names{i}
1175             <span class="keyword">case</span> <span class="string">'Plan View Map'</span>
1176                 <span class="comment">% Focus the figure</span>
1177                 hff = findobj(<span class="string">'name'</span>,<span class="string">'Plan View Map'</span>);
1178                 <span class="keyword">if</span> ~isempty(hff) &amp;&amp;  ishandle(hff)
1179                     figure(hff)
1180                     
1181                     <span class="comment">% Make the changes to figure</span>
1182                     set(gcf,<span class="string">'Color'</span>,BkgdColor);
1183                     set(gca,<span class="string">'FontSize'</span>,FntSize)
1184                     set(get(gca,<span class="string">'Title'</span>),<span class="string">'FontSize'</span>,FntSize)
1185                     set(gca,<span class="string">'Color'</span>,FigColor)
1186                     set(gca,<span class="string">'XColor'</span>,AxColor)
1187                     set(gca,<span class="string">'YColor'</span>,AxColor)
1188                     set(gca,<span class="string">'ZColor'</span>,AxColor)
1189                     set(findobj(gcf,<span class="string">'tag'</span>,<span class="string">'Colorbar'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'XColor'</span>,AxColor,<span class="string">'YColor'</span>,AxColor);
1190                     set(get(gca,<span class="string">'Title'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1191                     set(get(gca,<span class="string">'xLabel'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1192                     set(get(gca,<span class="string">'yLabel'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1193                 <span class="keyword">end</span>
1194             <span class="keyword">case</span> <span class="string">'Mean Cross Section Contour'</span>
1195                 <span class="comment">% Focus the figure</span>
1196                 hff = findobj(<span class="string">'name'</span>,<span class="string">'Mean Cross Section Contour'</span>);
1197                 <span class="keyword">if</span> ~isempty(hff) &amp;&amp;  ishandle(hff)
1198                     figure(hff)
1199                     
1200                     <span class="comment">% Make the changes to figure</span>
1201                     set(gcf,<span class="string">'Color'</span>,BkgdColor);
1202                     set(gca,<span class="string">'FontSize'</span>,FntSize)
1203                     set(get(gca,<span class="string">'Title'</span>),<span class="string">'FontSize'</span>,FntSize)
1204                     set(gca,<span class="string">'Color'</span>,[0.3 0.3 0.3]) <span class="comment">%FigColor)</span>
1205                     set(gca,<span class="string">'XColor'</span>,AxColor)
1206                     set(gca,<span class="string">'YColor'</span>,AxColor)
1207                     set(gca,<span class="string">'ZColor'</span>,AxColor)
1208                     set(findobj(gcf,<span class="string">'tag'</span>,<span class="string">'Colorbar'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'XColor'</span>,AxColor,<span class="string">'YColor'</span>,AxColor);
1209                     set(get(gca,<span class="string">'Title'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1210                     set(get(gca,<span class="string">'xLabel'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1211                     set(get(gca,<span class="string">'yLabel'</span>),<span class="string">'FontSize'</span>,FntSize,<span class="string">'Color'</span>,AxColor)
1212                     set(findobj(gca,<span class="string">'tag'</span>,<span class="string">'PlotBedElevation'</span>)   ,<span class="string">'color'</span>    ,AxColor)
1213                     set(findobj(gca,<span class="string">'tag'</span>,<span class="string">'ReferenceVectorText'</span>),<span class="string">'color'</span>    ,AxColor)
1214                 <span class="keyword">end</span>
1215             <span class="keyword">otherwise</span>
1216         <span class="keyword">end</span>
1217     <span class="keyword">end</span>
1218     
1219     
1220 <span class="keyword">end</span>
1221 
1222 <span class="comment">% [EOF] UpdatePlotStyle</span>
1223 <span class="comment">% --------------------------------------------------------------------</span>
1224 
1225 <span class="comment">% --------------------------------------------------------------------</span>
1226 <a name="_sub21" href="#_subfunctions" class="code">function load_prefs(hfigure)</a>
1227 <span class="comment">% Load the GUI preferences.  Also, initialize preferences if they don't</span>
1228 <span class="comment">% already exist.</span>
1229 
1230 <span class="comment">% Preferences:</span>
1231 <span class="comment">% 'cptplanview'     Path and filenames of current graphic (cpt) files for planview</span>
1232 <span class="comment">% 'cptmcs'          Path and filenames of current graphic (cpt) files for MCS</span>
1233 <span class="comment">% 'shoreline;</span>
1234 <span class="comment">% 'aerial'</span>
1235 
1236 <span class="keyword">if</span> ispref(<span class="string">'VMT'</span>,<span class="string">'cptplanview'</span>)
1237     cptplanview = getpref(<span class="string">'VMT'</span>,<span class="string">'cptplanview'</span>);
1238     <span class="keyword">if</span> exist(cptplanview.path,<span class="string">'dir'</span>)
1239         guiprefs.cpt_path = cptplanview.path;
1240     <span class="keyword">else</span>
1241         guiprefs.cpt_path = pwd;
1242     <span class="keyword">end</span>
1243     
1244     <span class="keyword">if</span> exist(fullfile(cptplanview.path,cptplanview.file),<span class="string">'file'</span>)
1245         guiprefs.cpt_file = cptplanview.file;
1246     <span class="keyword">else</span>
1247         guiprefs.cpt_file = [];
1248     <span class="keyword">end</span>
1249     
1250 <span class="keyword">else</span> <span class="comment">% Initialize graphics</span>
1251     guiprefs.cpt_path = pwd;
1252     guiprefs.cpt_file = [];
1253     
1254     cptplanview.path = pwd;
1255     cptplanview.file = [];
1256     setpref(<span class="string">'VMT'</span>,<span class="string">'cptplanview'</span>,cptplanview)
1257 <span class="keyword">end</span>
1258 
1259 <span class="keyword">if</span> ispref(<span class="string">'VMT'</span>,<span class="string">'cptmcs'</span>)
1260     cptmcs = getpref(<span class="string">'VMT'</span>,<span class="string">'cptmcs'</span>);
1261     <span class="keyword">if</span> exist(cptmcs.path,<span class="string">'dir'</span>)
1262         guiprefs.cpt_path = cptmcs.path;
1263     <span class="keyword">else</span>
1264         guiprefs.cpt_path = pwd;
1265     <span class="keyword">end</span>
1266     
1267     <span class="keyword">if</span> exist(fullfile(cptmcs.path,cptmcs.file),<span class="string">'file'</span>)
1268         guiprefs.cpt_file = cptmcs.file;
1269     <span class="keyword">else</span>
1270         guiprefs.cpt_file = [];
1271     <span class="keyword">end</span>
1272     
1273 <span class="keyword">else</span> <span class="comment">% Initialize graphics</span>
1274     guiprefs.cpt_path = pwd;
1275     guiprefs.cpt_file = [];
1276     
1277     cptmcs.path = pwd;
1278     cptmcs.file = [];
1279     setpref(<span class="string">'VMT'</span>,<span class="string">'cptplanview'</span>,cptplanview)
1280 <span class="keyword">end</span>
1281 <span class="keyword">if</span> ispref(<span class="string">'VMT'</span>,<span class="string">'shoreline'</span>)
1282     shoreline = getpref(<span class="string">'VMT'</span>,<span class="string">'shoreline'</span>);
1283     <span class="keyword">if</span> exist(shoreline.path,<span class="string">'dir'</span>)
1284         guiprefs.shoreline_path = shoreline.path;
1285     <span class="keyword">else</span>
1286         guiprefs.shoreline_path = pwd;
1287     <span class="keyword">end</span>
1288     
1289     <span class="keyword">if</span> exist(fullfile(shoreline.path,shoreline.file),<span class="string">'file'</span>)
1290         guiprefs.shoreline_file = shoreline.file;
1291     <span class="keyword">else</span>
1292         guiprefs.shoreline_file = [];
1293     <span class="keyword">end</span>
1294 <span class="keyword">end</span>
1295 <span class="keyword">if</span> ispref(<span class="string">'VMT'</span>,<span class="string">'aerial'</span>)
1296     aerial = getpref(<span class="string">'VMT'</span>,<span class="string">'aerial'</span>);
1297     <span class="keyword">if</span> exist(aerial.path,<span class="string">'dir'</span>)
1298         guiprefs.aerial_path = aerial.path;
1299     <span class="keyword">else</span>
1300         guiprefs.aerial_path = pwd;
1301     <span class="keyword">end</span>
1302     <span class="keyword">if</span> iscell(aerial.file)
1303         <span class="keyword">if</span> exist(fullfile(aerial.path,aerial.file{1}),<span class="string">'file'</span>)
1304             guiprefs.aerial_file = aerial.file;
1305         <span class="keyword">else</span>
1306             guiprefs.aerial_file = [];
1307         <span class="keyword">end</span>
1308     <span class="keyword">else</span>
1309         <span class="keyword">if</span> exist(fullfile(aerial.path,aerial.file),<span class="string">'file'</span>)
1310             guiprefs.aerial_file = aerial.file;
1311         <span class="keyword">else</span>
1312             guiprefs.aerial_file = [];
1313         <span class="keyword">end</span>
1314     <span class="keyword">end</span>
1315 <span class="keyword">end</span>
1316 
1317 <span class="comment">% Store the prefs</span>
1318 <span class="comment">% ---------------</span>
1319 setappdata(hfigure,<span class="string">'guiprefs'</span>,guiprefs)
1320 
1321 <a name="_sub22" href="#_subfunctions" class="code">function store_prefs(hfigure,pref)</a>
1322 <span class="comment">% Store preferences in the Application data and in the persistent</span>
1323 <span class="comment">% preferences data.</span>
1324 
1325 <span class="comment">% Preferences:</span>
1326 <span class="comment">% 'cptplanview'     Path and filenames of current graphic (cpt) files for planview</span>
1327 <span class="comment">% 'cptmcs'          Path and filenames of current graphic (cpt) files for MCS</span>
1328 
1329 guiprefs = getappdata(hfigure,<span class="string">'guiprefs'</span>);
1330 
1331 <span class="keyword">switch</span> pref
1332     <span class="keyword">case</span> <span class="string">'cptplanview'</span>
1333         cptplanview.path = guiprefs.cpt_path;
1334         cptplanview.file = guiprefs.cpt_file;
1335         setpref(<span class="string">'VMT'</span>,<span class="string">'cptplanview'</span>,cptplanview)
1336     <span class="keyword">case</span> <span class="string">'cptmcs'</span>
1337         cptmcs.path = guiprefs.cpt_path;
1338         cptmcs.file = guiprefs.cpt_file;
1339         setpref(<span class="string">'VMT'</span>,<span class="string">'cptmcs'</span>,cptmcs)
1340     <span class="keyword">otherwise</span>
1341 <span class="keyword">end</span>
1342 
1343 <span class="comment">% [EOF] store_prefs</span></pre></div>
<hr><address>Generated on Thu 24-Sep-2015 11:40:27 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>