<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of VMT_PlotXSContQuiver</title>
  <meta name="keywords" content="VMT_PlotXSContQuiver">
  <meta name="description" content="This function plots the the contour plot (mean XS) for the variable 'var'">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html VMT -->
<h1>VMT_PlotXSContQuiver
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This function plots the the contour plot (mean XS) for the variable 'var'</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [z,A,V,toquiv,log_text] = VMT_PlotXSContQuiver(z,A,V,var,sf,exag,qspchorz,qspcvert,secvecvar,vvelcomp,plot_english,allow_flux_flip,start_bank,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> This function plots the the contour plot (mean XS) for the variable 'var'
 and then plots quivers with secondary flow (vertical and transverse
 components) on top of the contour plot.  IF data is not supplied, user
 will be prompted to load data (browse to data).


 (adapted from code by J. Czuba)

 P.R. Jackson, USGS, 12-10-08 
 Last modified: F.L. Engel, USGS, 2/20/2013</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="VMT_PlotXSCont.html" class="code" title="function [z,A,V,zmin,zmax,log_text,fig_contour_handle] = VMT_PlotXSCont(z,A,V,var,exag,plot_english,allow_flux_flip,start_bank)">VMT_PlotXSCont</a>	Plots contours for the variable 'var' within the mean cross section given</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="VMT.html" class="code" title="function varargout = VMT(varargin)">VMT</a>	--- THE VELOCITY MAPPING TOOLBOX ---</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [z,A,V,toquiv,log_text] = VMT_PlotXSContQuiver(z,A,V,var,sf,exag,qspchorz,qspcvert,secvecvar,vvelcomp,plot_english,allow_flux_flip,start_bank,varargin)</a>
0002 <span class="comment">% This function plots the the contour plot (mean XS) for the variable 'var'</span>
0003 <span class="comment">% and then plots quivers with secondary flow (vertical and transverse</span>
0004 <span class="comment">% components) on top of the contour plot.  IF data is not supplied, user</span>
0005 <span class="comment">% will be prompted to load data (browse to data).</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% (adapted from code by J. Czuba)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% P.R. Jackson, USGS, 12-10-08</span>
0011 <span class="comment">% Last modified: F.L. Engel, USGS, 2/20/2013</span>
0012 
0013 
0014 <span class="comment">%% User input</span>
0015 <span class="keyword">if</span> exist(<span class="string">'plot_english'</span>) == 0
0016     plot_english = 0;  <span class="comment">%plot english units (else metric)</span>
0017     disp(<span class="string">'No units specified, plotting in metric units by default'</span>)
0018 <span class="keyword">end</span>
0019 
0020 AS = 1;  <span class="comment">%Turns on and off autoscaling (0 = off, 1 = on)</span>
0021 <span class="keyword">if</span> AS == 0
0022     MANrefvel = 25; <span class="comment">%Reference velocity in cm/s (manual setting)</span>
0023 <span class="keyword">end</span>
0024 
0025 <span class="comment">%% Parse any extra args</span>
0026 <span class="comment">%  This is used by VMT_GraphicsControl</span>
0027 <span class="keyword">if</span> any(size(varargin)&gt;0)
0028     reference_velocity = varargin{1};
0029     distance           = varargin{2};
0030     depth              = varargin{3};
0031 <span class="keyword">else</span>
0032     reference_velocity = [];
0033     distance           = [];
0034     depth              = [];
0035 <span class="keyword">end</span>
0036 
0037 <span class="comment">%% Determine vector sign convention based on start_bank</span>
0038 <span class="comment">% Add negative sign to reverse the +x direction (we take RHR with +x into</span>
0039 <span class="comment">% the page lookign DS, matlab uses opposite convention)</span>
0040 <span class="keyword">switch</span> start_bank
0041     <span class="keyword">case</span> <span class="string">'right_bank'</span>
0042         v = 1;
0043     <span class="keyword">otherwise</span> <span class="comment">% 'left_bank' or 'auto'</span>
0044         v = -1;
0045 <span class="keyword">end</span>
0046 
0047 <span class="comment">%% Plot the contour plot</span>
0048 <span class="keyword">if</span> isempty(z) &amp; isempty(A) &amp; isempty(V)
0049     [z,A,V,zmin,zmax,cont_log_text,fig_contour_handle] = <a href="VMT_PlotXSCont.html" class="code" title="function [z,A,V,zmin,zmax,log_text,fig_contour_handle] = VMT_PlotXSCont(z,A,V,var,exag,plot_english,allow_flux_flip,start_bank)">VMT_PlotXSCont</a>([],[],[],var,exag,plot_english,allow_flux_flip,start_bank);
0050 <span class="keyword">else</span>
0051     [z,A,V,zmin,zmax,cont_log_text,fig_contour_handle] = <a href="VMT_PlotXSCont.html" class="code" title="function [z,A,V,zmin,zmax,log_text,fig_contour_handle] = VMT_PlotXSCont(z,A,V,var,exag,plot_english,allow_flux_flip,start_bank)">VMT_PlotXSCont</a>(z,A,V,var,exag,plot_english,allow_flux_flip,start_bank);
0052 <span class="keyword">end</span>
0053 log_text = cont_log_text;
0054 
0055 <span class="comment">% if vvelcomp</span>
0056 <span class="comment">%     disp(['Plotting Secondary Flow Vector Field: ' secvecvar ' (with vertical velocity component)'])</span>
0057 <span class="comment">% else</span>
0058 <span class="comment">%     disp(['Plotting Secondary Flow Vector Field: ' secvecvar ' (without vertical velocity component)'])</span>
0059 <span class="comment">% end</span>
0060 <span class="comment">%% Plot the secondary flow quivers</span>
0061 
0062 plotref = getpref(<span class="string">'VMT'</span>,<span class="string">'plotref'</span>);
0063 <span class="keyword">if</span> plot_english
0064     sf = sf/0.01;  <span class="comment">%Scale factor changes with units--this makes the sf basically equal for engligh units to that for metric units</span>
0065 <span class="keyword">end</span>
0066 
0067 <span class="comment">%User input</span>
0068 
0069 clvls = 60;
0070 <span class="comment">%sf=3;       %Scale factor</span>
0071 <span class="comment">%exag=50;    %Vertical exaggeration</span>
0072 <span class="comment">%qspchorz=20;   %Vector spacing in # of ensembles</span>
0073 
0074 <span class="comment">% Misc computations</span>
0075 <span class="keyword">if</span> 0 <span class="comment">%A(1).Sup.binSize_cm == 25  %Changed some stuff below--not sure of the reason this 25 cm binsize is singled out  PRJ  (singled out due to vertical velocity bias--omit for now)</span>
0076     [I,J] = ind2sub(size(V.vp(2,:)),find(~isnan(V.vp(2,:))==1));  <span class="comment">% Use row 2 because all row 1 values are nans (WHY???--set to zero for ringing?)</span>
0077     et = J(1):qspchorz:J(end);
0078     [r c]=size(V.vp);
0079     bi = 1:2:r;  <span class="comment">%8:4:r;</span>
0080 <span class="keyword">else</span>
0081     <span class="comment">% Valid vector &quot;framing&quot;</span>
0082     <span class="comment">% Find the &quot;widest&quot; row of validdata. Typically this is row 1 with RG data,</span>
0083     <span class="comment">% however it may not be for M9 and/or RR data.</span>
0084     bb = sum(uint8(~isnan(V.vp)),2); <span class="comment">% Row with the most valid data</span>
0085     [~,i] = max(bb); 
0086     <span class="keyword">try</span>
0087         [I,J] = ind2sub(size(V.vp(i,:)),find(~isnan(V.vp(i,:))==1));
0088     <span class="keyword">catch</span> err <span class="comment">% If something doesn't work, attempt to use first row anyway</span>
0089         [I,J] = ind2sub(size(V.vp(1,:)),find(~isnan(V.vp(1,:))==1));
0090     <span class="keyword">end</span>
0091     
0092     et = J(1):qspchorz:J(end);
0093     [r c]=size(V.vp);
0094     bi = 1:qspcvert:r;
0095 <span class="keyword">end</span>
0096 
0097 <span class="comment">%zmin = floor(nanmin(nanmin(V.vp)));</span>
0098 <span class="comment">%zmax = ceil(nanmax(nanmax(V.vp)));</span>
0099 <span class="comment">%zinc = (zmax - zmin) / clvls;</span>
0100 <span class="comment">%zlevs = zmin:zinc:zmax;</span>
0101 
0102 <span class="comment">%Set the vertical velocity component</span>
0103 <span class="keyword">if</span> vvelcomp  <span class="comment">%include vertical velocity compoent in vector?</span>
0104     vertcomp = V.wSmooth;
0105 <span class="keyword">else</span>
0106     vertcomp = zeros(size(V.wSmooth));
0107 <span class="keyword">end</span>
0108 
0109 figure(fig_contour_handle); hold all
0110 <span class="comment">%quiver(V.mcsDist(bi,et),V.mcsDepth(bi,et),-sf.*V.vsSmooth(bi,et),-sf.*V.wSmooth(bi,et),0,'k')</span>
0111 <span class="keyword">switch</span> secvecvar
0112     <span class="keyword">case</span>{<span class="string">'transverse'</span>}  <span class="comment">%uses secondary velocity computed in the plane of the mean cross section (i.e. transverse)</span>
0113         vr = sqrt(abs((v.*sf.*V.vSmooth(bi,et)).^2 + (v.*sf./exag.*vertcomp(bi,et)).^2));
0114     <span class="keyword">case</span>{<span class="string">'secondary_zsd'</span>} <span class="comment">%Uses secondary velocity computed with a zero secondary discharge</span>
0115         vr = sqrt(abs((v.*sf.*V.vsSmooth(bi,et)).^2 + (v.*sf./exag.*vertcomp(bi,et)).^2));  
0116     <span class="keyword">case</span>{<span class="string">'secondary_roz'</span>}
0117         vr = sqrt(abs((v.*sf.*V.Roz.usSmooth(bi,et)).^2 + (v.*sf./exag.*vertcomp(bi,et)).^2));
0118     <span class="keyword">case</span>{<span class="string">'secondary_roz_y'</span>}
0119         vr = sqrt(abs((v.*sf.*V.Roz.usySmooth(bi,et)).^2 + (v.*sf./exag.*vertcomp(bi,et)).^2));
0120     <span class="keyword">case</span>{<span class="string">'primary_roz_y'</span>}
0121         vr = sqrt(abs((v.*sf.*V.Roz.upySmooth(bi,et)).^2 + (v.*sf./exag.*vertcomp(bi,et)).^2));
0122 <span class="keyword">end</span>
0123         
0124 <span class="comment">%vr=sqrt(abs(-sf.*V.vsSmooth(bi,et).^2+-sf./exag.*V.wSmooth(bi,et).^2));</span>
0125 [rw cl] = size(V.mcsDist(bi,et));
0126 <span class="keyword">switch</span> plotref
0127     <span class="keyword">case</span> <span class="string">'dfs'</span>
0128         toquiv(:,1) = reshape(V.mcsDist(bi,et),rw*cl,1);
0129         toquiv(:,2) = reshape(V.mcsDepth(bi,et),rw*cl,1);
0130     <span class="keyword">case</span> <span class="string">'hab'</span>
0131         HABdiff = bsxfun(@minus,V.mcsBed,V.mcsDepth); HABdiff(HABdiff&lt;0) = nan;
0132         toquiv(:,1) = reshape(V.mcsDist(bi,et),rw*cl,1);
0133         toquiv(:,2) = reshape(HABdiff(bi,et),rw*cl,1);
0134 <span class="keyword">end</span>
0135 <span class="keyword">switch</span> secvecvar
0136     <span class="keyword">case</span>{<span class="string">'transverse'</span>}
0137         toquiv(:,3) = reshape(v.*sf.*V.vSmooth(bi,et),rw*cl,1); 
0138         refvel = ceil(max(max(abs(V.vSmooth(bi,et)))));
0139         <span class="comment">%meansecvec = mean(mean(V.vSmooth(bi,et)));</span>
0140     <span class="keyword">case</span>{<span class="string">'secondary_zsd'</span>}
0141         toquiv(:,3) = reshape(v.*sf.*V.vsSmooth(bi,et),rw*cl,1); <span class="comment">%Add negative sign to reverse the +x direction (we take RHR with +x into the page lookign DS, matlab uses opposite convention)</span>
0142         refvel = ceil(max(max(abs(V.vsSmooth(bi,et)))));
0143         <span class="comment">%meansecvec = mean(mean(V.vsSmooth(bi,et)));</span>
0144     <span class="keyword">case</span>{<span class="string">'secondary_roz'</span>}
0145         toquiv(:,3) = reshape(v.*sf.*V.Roz.usSmooth(bi,et),rw*cl,1); <span class="comment">%Add negative sign to reverse the +x direction (we take RHR with +x into the page lookign DS, matlab uses opposite convention)</span>
0146         refvel = ceil(max(max(abs(V.Roz.usSmooth(bi,et)))));
0147         <span class="comment">%meansecvec = mean(mean(V.Roz.us(bi,et)));</span>
0148     <span class="keyword">case</span>{<span class="string">'secondary_roz_y'</span>}
0149         toquiv(:,3) = reshape(v.*sf.*V.Roz.usySmooth(bi,et),rw*cl,1); <span class="comment">%Add negative sign to reverse the +x direction (we take RHR with +x into the page lookign DS, matlab uses opposite convention)</span>
0150         refvel = ceil(max(max(abs(V.Roz.usySmooth(bi,et)))));
0151         <span class="comment">%meansecvec = mean(mean(V.Roz.usy(bi,et)));</span>
0152     <span class="keyword">case</span>{<span class="string">'primary_roz_y'</span>}
0153         toquiv(:,3) = reshape(v.*sf.*V.Roz.upySmooth(bi,et),rw*cl,1); <span class="comment">%Add negative sign to reverse the +x direction (we take RHR with +x into the page lookign DS, matlab uses opposite convention)</span>
0154         refvel = ceil(max(max(abs(V.Roz.upySmooth(bi,et)))));
0155         <span class="comment">%meansecvec = mean(mean(V.Roz.upy(bi,et))));</span>
0156 <span class="keyword">end</span>
0157 <span class="keyword">switch</span> plotref
0158     <span class="keyword">case</span> <span class="string">'dfs'</span>
0159         <span class="comment">% In DFS, we always reverse the y axis, therefore add negative to</span>
0160         <span class="comment">% vertical vector components</span>
0161         toquiv(:,4) = reshape(-sf./exag.*vertcomp(bi,et),rw*cl,1);  <span class="comment">%Add negative sign to account for flipped vertical axes</span>
0162     <span class="keyword">case</span> <span class="string">'hab'</span>
0163         <span class="comment">% In HAB, we do NOT reverse the y axis, therefore, do not negate</span>
0164         <span class="comment">% vertical component</span>
0165         toquiv(:,4) = reshape(sf./exag.*vertcomp(bi,et),rw*cl,1);  <span class="comment">%Add negative sign to account for flipped vertical axes</span>
0166 <span class="keyword">end</span>
0167 toquiv(:,5) = reshape(vr,rw*cl,1);
0168 
0169 <span class="comment">%Ref arrow</span>
0170 <span class="keyword">if</span> isempty(distance)
0171     x1 = 0.06*max(max(V.mcsDist));
0172     x2 = 0.95*max(max(V.mcsBed));
0173     <span class="keyword">if</span> AS == 0
0174         refvel = MANrefvel; <span class="comment">%manual scaling</span>
0175     <span class="keyword">end</span>
0176 <span class="keyword">else</span>
0177     x1 = distance;
0178     x2 = depth;
0179     refvel = reference_velocity;
0180 <span class="keyword">end</span>
0181 x3=sf.*refvel; <span class="comment">%Set to rounded max secondary velocity (absolute value added 3/29/12 PRJ) (autoscaling)</span>
0182 x4=0;
0183 x5=x3;
0184 toquiv(end+1,1) = x1;
0185 toquiv(<span class="keyword">end</span>,2) = x2;
0186 toquiv(<span class="keyword">end</span>,3) = x3;
0187 toquiv(<span class="keyword">end</span>,4) = x4;
0188 toquiv(<span class="keyword">end</span>,5) = x5;
0189 <span class="comment">%quiverc(toquiv(:,1),toquiv(:,2),toquiv(:,3),toquiv(:,4),sf); hold on</span>
0190 
0191 
0192 <span class="keyword">if</span> plot_english
0193     unitlabel = <span class="string">'(ft/s)'</span>;
0194 <span class="keyword">else</span>
0195     unitlabel = <span class="string">'(cm/s)'</span>;
0196 <span class="keyword">end</span>
0197 
0198 <span class="keyword">if</span> plot_english <span class="comment">%english units</span>
0199     convfact = 0.03281; <span class="comment">%cm/s to ft/s</span>
0200     <span class="keyword">switch</span> var
0201         <span class="keyword">case</span>{<span class="string">'backscatter'</span>}
0202             convfact = 1.0; 
0203         <span class="keyword">case</span>{<span class="string">'flowangle'</span>}
0204             convfact = 1.0;
0205     <span class="keyword">end</span>
0206     
0207     <span class="keyword">switch</span> plotref
0208         <span class="keyword">case</span> <span class="string">'dfs'</span>
0209             <span class="comment">%ylim([0 max(V.mcsBed*3.281)])</span>
0210             ylabel_handle = ylabel(<span class="string">'Depth (ft)'</span>);
0211             xlabel_handle = xlabel(<span class="string">'Distance (ft)'</span>);
0212             rf_label_pos = [0.06*max(max(V.mcsDist)) 0.9*max(max(V.mcsBed))].*3.28084; <span class="comment">% Conversion is to meters</span>
0213             ref_vector_text_handle = text(rf_label_pos(1), rf_label_pos(2),[num2str(refvel*0.03281,3) <span class="string">' ft/s'</span>],<span class="string">'FontSize'</span>,12,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0214         <span class="keyword">case</span> <span class="string">'hab'</span>
0215             <span class="comment">%ylim([0 max(V.mcsBed*3.281)])</span>
0216             ylabel_handle = ylabel(<span class="string">'Height above bottom (ft)'</span>);
0217             xlabel_handle = xlabel(<span class="string">'Distance (ft)'</span>);
0218             rf_label_pos = [0.06*max(max(V.mcsDist)) 0.9*max(max(V.mcsBed))].*3.28084; <span class="comment">% Conversion is to meters</span>
0219             ref_vector_text_handle = text(rf_label_pos(1), rf_label_pos(2),[num2str(refvel*0.03281,3) <span class="string">' ft/s'</span>],<span class="string">'FontSize'</span>,12,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0220     <span class="keyword">end</span>
0221     
0222     hh = quiverc2wcmap(toquiv(:,1)*3.281,toquiv(:,2)*3.281,toquiv(:,3)*0.03281,toquiv(:,4)*0.03281,0,toquiv(:,5)*0.03281,exag);
0223     <span class="comment">%plot(V.mcsDist(1,:)*3.281,V.mcsBed*3.281,'w', 'LineWidth',2); hold on</span>
0224     
0225     caxis([zmin*convfact zmax*convfact]) <span class="comment">%Reset the color bar to match that in the original contour plot</span>
0226     <span class="keyword">switch</span> var        
0227         <span class="keyword">case</span>{<span class="string">'streamwise'</span>}
0228             title_handle = title({[<span class="string">'Streamwise Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0229         <span class="keyword">case</span>{<span class="string">'transverse'</span>}
0230             title_handle = title({[<span class="string">'Transverse Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0231         <span class="keyword">case</span>{<span class="string">'vertical'</span>}
0232             title_handle = title({[<span class="string">'Vertical Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0233         <span class="keyword">case</span>{<span class="string">'mag'</span>}
0234             title_handle = title({[<span class="string">'Velocity Magnitude (Streamwise and Transverse) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0235         <span class="keyword">case</span>{<span class="string">'east'</span>}
0236             title_handle = title({[<span class="string">'East Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0237         <span class="keyword">case</span>{<span class="string">'error'</span>}
0238             title_handle = title({[<span class="string">'Error Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0239         <span class="keyword">case</span>{<span class="string">'north'</span>}
0240             title_handle = title({[<span class="string">'North Velocity '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0241         <span class="keyword">case</span>{<span class="string">'primary_zsd'</span>}
0242             title_handle = title({[<span class="string">'Primary Velocity (Zero Secondary Discharge Definition) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0243         <span class="keyword">case</span>{<span class="string">'secondary_zsd'</span>}
0244             title_handle = title({[<span class="string">'Secondary Velocity (Zero Secondary Discharge Definition) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0245         <span class="keyword">case</span>{<span class="string">'primary_roz'</span>}
0246             title_handle = title({[<span class="string">'Primary Velocity (Rozovskii Definition) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0247         <span class="keyword">case</span>{<span class="string">'secondary_roz'</span>}
0248             title_handle = title({[<span class="string">'Secondary Velocity (Rozovskii Definition) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0249         <span class="keyword">case</span>{<span class="string">'primary_roz_x'</span>}
0250             title_handle = title({[<span class="string">'Primary Velocity (Rozovskii Definition; Downstream Component) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>); 
0251         <span class="keyword">case</span>{<span class="string">'primary_roz_y'</span>}
0252             title_handle = title({[<span class="string">'Primary Velocity (Rozovskii Definition; Cross-Stream Component) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);       
0253         <span class="keyword">case</span>{<span class="string">'secondary_roz_x'</span>}
0254             title_handle = title({[<span class="string">'Secondary Velocity (Rozovskii Definition; Downstream Component) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);       
0255         <span class="keyword">case</span>{<span class="string">'secondary_roz_y'</span>}
0256             title_handle = title({[<span class="string">'Secondary Velocity (Rozovskii Definition; Cross-Stream Component) '</span> unitlabel];[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0257         <span class="keyword">case</span>{<span class="string">'backscatter'</span>}
0258             title_handle = title({<span class="string">'Backscatter Intensity (dB)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0259         <span class="keyword">case</span>{<span class="string">'flowangle'</span>}
0260             title_handle = title({<span class="string">'Flow Direction (deg)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0261         <span class="keyword">case</span>{<span class="string">'vorticity_vw'</span>}
0262             title_handle = title({<span class="string">'Streamwise Vorticity'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0263         <span class="keyword">case</span>{<span class="string">'vorticity_zsd'</span>}
0264             title_handle = title({<span class="string">'Streamwise Vorticity (Zero Secondary Discharge Definition)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0265         <span class="keyword">case</span>{<span class="string">'vorticity_roz'</span>}
0266             title_handle = title({<span class="string">'Streamwise Vorticity (Rozovskii Definition)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0267     <span class="keyword">end</span>
0268     
0269 
0270 
0271     
0272 <span class="keyword">else</span> <span class="comment">%metric units</span>
0273     hh = quiverc2wcmap(toquiv(:,1),toquiv(:,2),toquiv(:,3),toquiv(:,4),0,toquiv(:,5),exag);
0274     <span class="comment">%plot(V.mcsDist(1,:),V.mcsBed,'w', 'LineWidth',2); hold on</span>
0275     <span class="comment">%ylim([0 max(V.mcsBed)])</span>
0276     <span class="keyword">switch</span> plotref
0277         <span class="keyword">case</span> <span class="string">'dfs'</span>
0278             ylabel_handle = ylabel(<span class="string">'Depth (m)'</span>);
0279             xlabel_handle = xlabel(<span class="string">'Distance (m)'</span>);
0280             rf_label_pos = [0.06*max(max(V.mcsDist)) 0.9*max(max(V.mcsBed))];
0281             ref_vector_text_handle = text(rf_label_pos(1), rf_label_pos(2),[num2str(refvel) <span class="string">' cm/s'</span>],<span class="string">'FontSize'</span>,12,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0282         <span class="keyword">case</span> <span class="string">'hab'</span>
0283             ylabel_handle = ylabel(<span class="string">'Height above bottom (m)'</span>);
0284             xlabel_handle = xlabel(<span class="string">'Distance (m)'</span>);
0285             rf_label_pos = [0.06*max(max(V.mcsDist)) 0.9*max(max(V.mcsBed))];
0286             ref_vector_text_handle = text(rf_label_pos(1), rf_label_pos(2),[num2str(refvel) <span class="string">' cm/s'</span>],<span class="string">'FontSize'</span>,12,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0287     <span class="keyword">end</span>
0288     <span class="comment">%Reset the color bar to match that in the original contour plot</span>
0289     <span class="keyword">if</span> strcmp(var,<span class="string">'vorticity_vw'</span>)||strcmp(var,<span class="string">'vorticity_zsd'</span>)||strcmp(var,<span class="string">'vorticity_roz'</span>)
0290         rng = zmax - zmin;
0291         caxis([-rng/2 rng/2])
0292     <span class="keyword">else</span>
0293         caxis([zmin zmax])
0294     <span class="keyword">end</span>
0295     <span class="keyword">switch</span> var        
0296         <span class="keyword">case</span>{<span class="string">'streamwise'</span>}
0297             title_handle = title({<span class="string">'Streamwise Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0298         <span class="keyword">case</span>{<span class="string">'transverse'</span>}
0299             title_handle = title({<span class="string">'Transverse Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0300         <span class="keyword">case</span>{<span class="string">'vertical'</span>}
0301             title_handle = title({<span class="string">'Vertical Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0302         <span class="keyword">case</span>{<span class="string">'mag'</span>}
0303             title_handle = title({<span class="string">'Velocity Magnitude (Streamwise and Transverse) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0304         <span class="keyword">case</span>{<span class="string">'east'</span>}
0305             title_handle = title({<span class="string">'East Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0306         <span class="keyword">case</span>{<span class="string">'error'</span>}
0307             title_handle = title({<span class="string">'Error Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0308         <span class="keyword">case</span>{<span class="string">'north'</span>}
0309             title_handle = title({<span class="string">'North Velocity (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0310         <span class="keyword">case</span>{<span class="string">'primary_zsd'</span>}
0311             title_handle = title({<span class="string">'Primary Velocity (Zero Secondary Discharge Definition) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0312         <span class="keyword">case</span>{<span class="string">'secondary_zsd'</span>}
0313             title_handle = title({<span class="string">'Secondary Velocity (Zero Secondary Discharge Definition) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0314         <span class="keyword">case</span>{<span class="string">'primary_roz'</span>}
0315             title_handle = title({<span class="string">'Primary Velocity (Rozovskii Definition) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0316         <span class="keyword">case</span>{<span class="string">'secondary_roz'</span>}
0317             title_handle = title({<span class="string">'Secondary Velocity (Rozovskii Definition) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);   
0318         <span class="keyword">case</span>{<span class="string">'primary_roz_x'</span>}
0319             title_handle = title({<span class="string">'Primary Velocity (Rozovskii Definition; Downstream Component) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0320         <span class="keyword">case</span>{<span class="string">'primary_roz_y'</span>}
0321             title_handle = title({<span class="string">'Primary Velocity (Rozovskii Definition; Cross-Stream Component) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0322         <span class="keyword">case</span>{<span class="string">'secondary_roz_x'</span>}
0323             title_handle = title({<span class="string">'Secondary Velocity (Rozovskii Definition; Downstream Component) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);       
0324         <span class="keyword">case</span>{<span class="string">'secondary_roz_y'</span>}
0325             title_handle = title({<span class="string">'Secondary Velocity (Rozovskii Definition; Cross-Stream Component) (cm/s)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0326         <span class="keyword">case</span>{<span class="string">'backscatter'</span>}
0327             title_handle = title({<span class="string">'Backscatter Intensity (dB)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0328         <span class="keyword">case</span>{<span class="string">'flowangle'</span>}
0329             title_handle = title({<span class="string">'Flow Direction (deg)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0330         <span class="keyword">case</span>{<span class="string">'vorticity_vw'</span>}
0331             title_handle = title({<span class="string">'Streamwise Vorticity'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0332         <span class="keyword">case</span>{<span class="string">'vorticity_zsd'</span>}
0333             title_handle = title({<span class="string">'Streamwise Vorticity (Zero Secondary Discharge Definition)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0334         <span class="keyword">case</span>{<span class="string">'vorticity_roz'</span>}
0335             title_handle = title({<span class="string">'Streamwise Vorticity (Rozovskii Definition)'</span>;[<span class="string">'with secondary flow vectors ('</span> secvecvar <span class="string">')'</span>]},<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0336     <span class="keyword">end</span>
0337     
0338     
0339 
0340 <span class="keyword">end</span>
0341 
0342 <span class="comment">% Tag the elements in the figure</span>
0343 secondary_vector_handles = findobj(gcf,<span class="string">'Type'</span>,<span class="string">'line'</span>,<span class="string">'-not'</span>,<span class="string">'tag'</span>,<span class="string">'PlotBedElevation'</span>);
0344 set(secondary_vector_handles,       <span class="string">'Tag'</span>,<span class="string">'SecondaryVectors'</span>)
0345 set(ref_vector_text_handle,         <span class="string">'Tag'</span>,<span class="string">'ReferenceVectorText'</span>)
0346 set(title_handle,                   <span class="string">'Tag'</span>,<span class="string">'ContourPlotTitle'</span>)
0347 set(ylabel_handle,                  <span class="string">'Tag'</span>,<span class="string">'yLabelText'</span>)
0348 set(xlabel_handle,                  <span class="string">'Tag'</span>,<span class="string">'xLabelText'</span>)
0349 
0350 <span class="comment">% Adjust the plot</span>
0351 set(gca,<span class="keyword">...</span>
0352     <span class="string">'DataAspectRatio'</span>,   [exag 1 1],<span class="keyword">...</span>
0353     <span class="string">'PlotBoxAspectRatio'</span>,[exag 1 1]<span class="keyword">...</span>
0354     <span class="keyword">...</span><span class="comment">'FontSize',          14)</span>
0355     )
0356 <span class="comment">% set(get(gca,'Title'),   'FontSize',14,'Color','w')</span>
0357 <span class="comment">% set(get(gca,'xlabel'),  'FontSize',14,'Color','w')</span>
0358 <span class="comment">% set(get(gca,'ylabel'),  'FontSize',14,'Color','w')</span>
0359 <span class="comment">% set(gca,...</span>
0360 <span class="comment">%     'XColor','w',...</span>
0361 <span class="comment">%     'YColor','w',...</span>
0362 <span class="comment">%     'ZColor','w',...</span>
0363 <span class="comment">%     'Color',[0.3 0.3 0.3])</span>
0364 <span class="comment">% set(gcf,...</span>
0365 <span class="comment">%     'InvertHardCopy','off',...</span>
0366 <span class="comment">%     'Color','k')</span>
0367 <span class="keyword">if</span> 1  <span class="comment">%Set the vector line widths</span>
0368     VectorLineWidth = 1.0;
0369     set(secondary_vector_handles  ,<span class="string">'LineWidth'</span>,VectorLineWidth)
0370 <span class="keyword">end</span>
0371 
0372 
0373 
0374 <span class="comment">% scrsz = get(0,'ScreenSize');</span>
0375 <span class="comment">% figure('OuterPosition',[1 scrsz(4) scrsz(3) scrsz(4)])</span>
0376 
0377 <span class="comment">%Display the ratio of the mean secondary and primary velocity magnitudes</span>
0378 spratio_zsd = nanmedian(nanmedian(abs(V.vs)))./nanmedian(nanmedian(abs(V.vp)));
0379 spratio_roz = nanmedian(nanmedian(abs(V.Roz.usy)))./nanmedian(nanmedian(abs(V.Roz.up)));
0380 <span class="comment">% disp(['Ratio of median Secondary to median Primary Velocity (zsd) = ' num2str(spratio_zsd)])</span>
0381 <span class="comment">% disp(['Ratio of median Secondary to median Primary Velocity (roz) = ' num2str(spratio_roz)])</span>
0382 log_text = vertcat(log_text,<span class="keyword">...</span>
0383     {[<span class="string">'   Ratio of median Secondary to median Primary Velocity (zsd) = '</span> num2str(spratio_zsd)];<span class="keyword">...</span>
0384     [<span class="string">'   Ratio of median Secondary to median Primary Velocity (roz) = '</span> num2str(spratio_roz)]}<span class="keyword">...</span>
0385     );
0386 
0387 <span class="keyword">return</span>
0388 
0389 
0390 <span class="comment">%Add labels to the reference arrow and colorbar</span>
0391 <span class="comment">% text(50,12,['Vertical Distances Exaggerated by ',num2str(exag)],'FontSize',16)</span>
0392 <span class="comment">% text(140,17,'10 cm/s','FontSize',16)</span>
0393</pre></div>
<hr><address>Generated on Tue 04-Apr-2017 10:28:30 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>